<!DOCTYPE html>
<html class="writer-html5" lang="en" data-content_root="../../">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>MeasurementSystem.measurement_server &mdash; Measurement System 0.1.dev1+g9e4a58d documentation</title>
      <link rel="stylesheet" type="text/css" href="../../_static/pygments.css?v=80d5e7a1" />
      <link rel="stylesheet" type="text/css" href="../../_static/css/theme.css?v=19f00094" />
      <link rel="stylesheet" type="text/css" href="../../_static/copybutton.css?v=76b2166b" />


  <!--[if lt IE 9]>
    <script src="../../_static/js/html5shiv.min.js"></script>
  <![endif]-->

        <script src="../../_static/jquery.js?v=5d32c60e"></script>
        <script src="../../_static/_sphinx_javascript_frameworks_compat.js?v=2cd50e6c"></script>
        <script src="../../_static/documentation_options.js?v=dbc61f67"></script>
        <script src="../../_static/doctools.js?v=9a2dae69"></script>
        <script src="../../_static/sphinx_highlight.js?v=dc90522c"></script>
        <script src="../../_static/clipboard.min.js?v=a7894cd8"></script>
        <script src="../../_static/copybutton.js?v=f281be69"></script>
    <script src="../../_static/js/theme.js"></script>
    <link rel="index" title="Index" href="../../genindex.html" />
    <link rel="search" title="Search" href="../../search.html" />
</head>

<body class="wy-body-for-nav">
  <div class="wy-grid-for-nav">
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search"  style="background: #2980b9" >



          <a href="../../index.html">

              <img src="../../_static/logo.png" class="logo" alt="Logo"/>
          </a>
              <div class="version">
                0.1.dev1+g9e4a58d
              </div>
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="../../search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" aria-label="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>
        </div><div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="Navigation menu">
              <ul>
<li class="toctree-l1"><a class="reference internal" href="../../reference.html">Reference</a><ul>
<li class="toctree-l2"><a class="reference internal" href="../../reference.html#module-MeasurementSystem.measurement_server">Measurement Server</a><ul>
<li class="toctree-l3"><a class="reference internal" href="../../reference.html#MeasurementSystem.measurement_server.ControlTask"><code class="docutils literal notranslate"><span class="pre">ControlTask</span></code></a><ul>
<li class="toctree-l4"><a class="reference internal" href="../../reference.html#MeasurementSystem.measurement_server.ControlTask.SendCommandCallbackType"><code class="docutils literal notranslate"><span class="pre">SendCommandCallbackType</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="../../reference.html#MeasurementSystem.measurement_server.ControlTask.add_command"><code class="docutils literal notranslate"><span class="pre">add_command()</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="../../reference.html#MeasurementSystem.measurement_server.ControlTask.start"><code class="docutils literal notranslate"><span class="pre">start()</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="../../reference.html#MeasurementSystem.measurement_server.ControlTask.stop"><code class="docutils literal notranslate"><span class="pre">stop()</span></code></a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="../../reference.html#MeasurementSystem.measurement_server.ControlTaskManager"><code class="docutils literal notranslate"><span class="pre">ControlTaskManager</span></code></a><ul>
<li class="toctree-l4"><a class="reference internal" href="../../reference.html#MeasurementSystem.measurement_server.ControlTaskManager.add_command_to_task"><code class="docutils literal notranslate"><span class="pre">add_command_to_task()</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="../../reference.html#MeasurementSystem.measurement_server.ControlTaskManager.initialize_tasks"><code class="docutils literal notranslate"><span class="pre">initialize_tasks()</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="../../reference.html#MeasurementSystem.measurement_server.ControlTaskManager.start_tasks"><code class="docutils literal notranslate"><span class="pre">start_tasks()</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="../../reference.html#MeasurementSystem.measurement_server.ControlTaskManager.stop_tasks"><code class="docutils literal notranslate"><span class="pre">stop_tasks()</span></code></a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="../../reference.html#MeasurementSystem.measurement_server.HardwareInterface"><code class="docutils literal notranslate"><span class="pre">HardwareInterface</span></code></a><ul>
<li class="toctree-l4"><a class="reference internal" href="../../reference.html#MeasurementSystem.measurement_server.HardwareInterface.close"><code class="docutils literal notranslate"><span class="pre">close()</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="../../reference.html#MeasurementSystem.measurement_server.HardwareInterface.from_json"><code class="docutils literal notranslate"><span class="pre">from_json()</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="../../reference.html#MeasurementSystem.measurement_server.HardwareInterface.initialize"><code class="docutils literal notranslate"><span class="pre">initialize()</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="../../reference.html#MeasurementSystem.measurement_server.HardwareInterface.to_json"><code class="docutils literal notranslate"><span class="pre">to_json()</span></code></a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="../../reference.html#MeasurementSystem.measurement_server.MeasurementSystem"><code class="docutils literal notranslate"><span class="pre">MeasurementSystem</span></code></a><ul>
<li class="toctree-l4"><a class="reference internal" href="../../reference.html#MeasurementSystem.measurement_server.MeasurementSystem.add_command_to_send_queue"><code class="docutils literal notranslate"><span class="pre">add_command_to_send_queue()</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="../../reference.html#MeasurementSystem.measurement_server.MeasurementSystem.close"><code class="docutils literal notranslate"><span class="pre">close()</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="../../reference.html#MeasurementSystem.measurement_server.MeasurementSystem.init_comvisu"><code class="docutils literal notranslate"><span class="pre">init_comvisu()</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="../../reference.html#MeasurementSystem.measurement_server.MeasurementSystem.printConsole"><code class="docutils literal notranslate"><span class="pre">printConsole()</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="../../reference.html#MeasurementSystem.measurement_server.MeasurementSystem.process_commands"><code class="docutils literal notranslate"><span class="pre">process_commands()</span></code></a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="../../reference.html#MeasurementSystem.measurement_server.MeasurementTask"><code class="docutils literal notranslate"><span class="pre">MeasurementTask</span></code></a><ul>
<li class="toctree-l4"><a class="reference internal" href="../../reference.html#MeasurementSystem.measurement_server.MeasurementTask.SendCommandCallbackType_2"><code class="docutils literal notranslate"><span class="pre">SendCommandCallbackType_2</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="../../reference.html#MeasurementSystem.measurement_server.MeasurementTask.start"><code class="docutils literal notranslate"><span class="pre">start()</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="../../reference.html#MeasurementSystem.measurement_server.MeasurementTask.stop"><code class="docutils literal notranslate"><span class="pre">stop()</span></code></a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="../../reference.html#MeasurementSystem.measurement_server.MeasurementTaskManager"><code class="docutils literal notranslate"><span class="pre">MeasurementTaskManager</span></code></a><ul>
<li class="toctree-l4"><a class="reference internal" href="../../reference.html#MeasurementSystem.measurement_server.MeasurementTaskManager.initialize_tasks"><code class="docutils literal notranslate"><span class="pre">initialize_tasks()</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="../../reference.html#MeasurementSystem.measurement_server.MeasurementTaskManager.start_tasks"><code class="docutils literal notranslate"><span class="pre">start_tasks()</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="../../reference.html#MeasurementSystem.measurement_server.MeasurementTaskManager.stop_tasks"><code class="docutils literal notranslate"><span class="pre">stop_tasks()</span></code></a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="../../reference.html#MeasurementSystem.measurement_server.main"><code class="docutils literal notranslate"><span class="pre">main()</span></code></a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="../../reference.html#module-MeasurementSystem.core.Utils">Core Utilities</a><ul>
<li class="toctree-l3"><a class="reference internal" href="../../reference.html#MeasurementSystem.core.Utils.OrderedPriorityQueue"><code class="docutils literal notranslate"><span class="pre">OrderedPriorityQueue</span></code></a><ul>
<li class="toctree-l4"><a class="reference internal" href="../../reference.html#MeasurementSystem.core.Utils.OrderedPriorityQueue.get"><code class="docutils literal notranslate"><span class="pre">get()</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="../../reference.html#MeasurementSystem.core.Utils.OrderedPriorityQueue.put"><code class="docutils literal notranslate"><span class="pre">put()</span></code></a></li>
</ul>
</li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="../../reference.html#module-MeasurementSystem.core.driver.Hardware">Hardware Driver</a><ul>
<li class="toctree-l3"><a class="reference internal" href="../../reference.html#MeasurementSystem.core.driver.Hardware.Channel"><code class="docutils literal notranslate"><span class="pre">Channel</span></code></a><ul>
<li class="toctree-l4"><a class="reference internal" href="../../reference.html#MeasurementSystem.core.driver.Hardware.Channel.close"><code class="docutils literal notranslate"><span class="pre">close()</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="../../reference.html#MeasurementSystem.core.driver.Hardware.Channel.initialize"><code class="docutils literal notranslate"><span class="pre">initialize()</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="../../reference.html#MeasurementSystem.core.driver.Hardware.Channel.set_model_from_str"><code class="docutils literal notranslate"><span class="pre">set_model_from_str()</span></code></a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="../../reference.html#MeasurementSystem.core.driver.Hardware.ChannelManager"><code class="docutils literal notranslate"><span class="pre">ChannelManager</span></code></a><ul>
<li class="toctree-l4"><a class="reference internal" href="../../reference.html#MeasurementSystem.core.driver.Hardware.ChannelManager.add_channels"><code class="docutils literal notranslate"><span class="pre">add_channels()</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="../../reference.html#MeasurementSystem.core.driver.Hardware.ChannelManager.close"><code class="docutils literal notranslate"><span class="pre">close()</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="../../reference.html#MeasurementSystem.core.driver.Hardware.ChannelManager.get_channels"><code class="docutils literal notranslate"><span class="pre">get_channels()</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="../../reference.html#MeasurementSystem.core.driver.Hardware.ChannelManager.get_channels_by_name"><code class="docutils literal notranslate"><span class="pre">get_channels_by_name()</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="../../reference.html#MeasurementSystem.core.driver.Hardware.ChannelManager.get_channels_by_type"><code class="docutils literal notranslate"><span class="pre">get_channels_by_type()</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="../../reference.html#MeasurementSystem.core.driver.Hardware.ChannelManager.get_modules"><code class="docutils literal notranslate"><span class="pre">get_modules()</span></code></a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="../../reference.html#MeasurementSystem.core.driver.Hardware.ChannelProperties"><code class="docutils literal notranslate"><span class="pre">ChannelProperties</span></code></a><ul>
<li class="toctree-l4"><a class="reference internal" href="../../reference.html#MeasurementSystem.core.driver.Hardware.ChannelProperties.Type"><code class="docutils literal notranslate"><span class="pre">Type</span></code></a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="../../reference.html#MeasurementSystem.core.driver.Hardware.Channel_MCC118_VoltageChannel"><code class="docutils literal notranslate"><span class="pre">Channel_MCC118_VoltageChannel</span></code></a><ul>
<li class="toctree-l4"><a class="reference internal" href="../../reference.html#MeasurementSystem.core.driver.Hardware.Channel_MCC118_VoltageChannel.close"><code class="docutils literal notranslate"><span class="pre">close()</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="../../reference.html#MeasurementSystem.core.driver.Hardware.Channel_MCC118_VoltageChannel.initialize"><code class="docutils literal notranslate"><span class="pre">initialize()</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="../../reference.html#MeasurementSystem.core.driver.Hardware.Channel_MCC118_VoltageChannel.read"><code class="docutils literal notranslate"><span class="pre">read()</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="../../reference.html#MeasurementSystem.core.driver.Hardware.Channel_MCC118_VoltageChannel.to_dict"><code class="docutils literal notranslate"><span class="pre">to_dict()</span></code></a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="../../reference.html#MeasurementSystem.core.driver.Hardware.Channel_MCC134_ThermocoupleChannel"><code class="docutils literal notranslate"><span class="pre">Channel_MCC134_ThermocoupleChannel</span></code></a><ul>
<li class="toctree-l4"><a class="reference internal" href="../../reference.html#MeasurementSystem.core.driver.Hardware.Channel_MCC134_ThermocoupleChannel.close"><code class="docutils literal notranslate"><span class="pre">close()</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="../../reference.html#MeasurementSystem.core.driver.Hardware.Channel_MCC134_ThermocoupleChannel.initialize"><code class="docutils literal notranslate"><span class="pre">initialize()</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="../../reference.html#MeasurementSystem.core.driver.Hardware.Channel_MCC134_ThermocoupleChannel.read"><code class="docutils literal notranslate"><span class="pre">read()</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="../../reference.html#MeasurementSystem.core.driver.Hardware.Channel_MCC134_ThermocoupleChannel.to_dict"><code class="docutils literal notranslate"><span class="pre">to_dict()</span></code></a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="../../reference.html#MeasurementSystem.core.driver.Hardware.Channel_RPI_BufferedDigitalInput"><code class="docutils literal notranslate"><span class="pre">Channel_RPI_BufferedDigitalInput</span></code></a><ul>
<li class="toctree-l4"><a class="reference internal" href="../../reference.html#MeasurementSystem.core.driver.Hardware.Channel_RPI_BufferedDigitalInput.close"><code class="docutils literal notranslate"><span class="pre">close()</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="../../reference.html#MeasurementSystem.core.driver.Hardware.Channel_RPI_BufferedDigitalInput.initialize"><code class="docutils literal notranslate"><span class="pre">initialize()</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="../../reference.html#MeasurementSystem.core.driver.Hardware.Channel_RPI_BufferedDigitalInput.read"><code class="docutils literal notranslate"><span class="pre">read()</span></code></a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="../../reference.html#MeasurementSystem.core.driver.Hardware.Channel_RPI_DigitalInput"><code class="docutils literal notranslate"><span class="pre">Channel_RPI_DigitalInput</span></code></a><ul>
<li class="toctree-l4"><a class="reference internal" href="../../reference.html#MeasurementSystem.core.driver.Hardware.Channel_RPI_DigitalInput.close"><code class="docutils literal notranslate"><span class="pre">close()</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="../../reference.html#MeasurementSystem.core.driver.Hardware.Channel_RPI_DigitalInput.initialize"><code class="docutils literal notranslate"><span class="pre">initialize()</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="../../reference.html#MeasurementSystem.core.driver.Hardware.Channel_RPI_DigitalInput.read"><code class="docutils literal notranslate"><span class="pre">read()</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="../../reference.html#MeasurementSystem.core.driver.Hardware.Channel_RPI_DigitalInput.readRaw"><code class="docutils literal notranslate"><span class="pre">readRaw()</span></code></a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="../../reference.html#MeasurementSystem.core.driver.Hardware.Channel_RPI_DigitalOutput"><code class="docutils literal notranslate"><span class="pre">Channel_RPI_DigitalOutput</span></code></a><ul>
<li class="toctree-l4"><a class="reference internal" href="../../reference.html#MeasurementSystem.core.driver.Hardware.Channel_RPI_DigitalOutput.close"><code class="docutils literal notranslate"><span class="pre">close()</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="../../reference.html#MeasurementSystem.core.driver.Hardware.Channel_RPI_DigitalOutput.initialize"><code class="docutils literal notranslate"><span class="pre">initialize()</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="../../reference.html#MeasurementSystem.core.driver.Hardware.Channel_RPI_DigitalOutput.write"><code class="docutils literal notranslate"><span class="pre">write()</span></code></a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="../../reference.html#MeasurementSystem.core.driver.Hardware.Channel_RPI_FrequencyCounter"><code class="docutils literal notranslate"><span class="pre">Channel_RPI_FrequencyCounter</span></code></a><ul>
<li class="toctree-l4"><a class="reference internal" href="../../reference.html#MeasurementSystem.core.driver.Hardware.Channel_RPI_FrequencyCounter.close"><code class="docutils literal notranslate"><span class="pre">close()</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="../../reference.html#MeasurementSystem.core.driver.Hardware.Channel_RPI_FrequencyCounter.initialize"><code class="docutils literal notranslate"><span class="pre">initialize()</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="../../reference.html#MeasurementSystem.core.driver.Hardware.Channel_RPI_FrequencyCounter.read"><code class="docutils literal notranslate"><span class="pre">read()</span></code></a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="../../reference.html#MeasurementSystem.core.driver.Hardware.Channel_RPI_InternalTemperature"><code class="docutils literal notranslate"><span class="pre">Channel_RPI_InternalTemperature</span></code></a><ul>
<li class="toctree-l4"><a class="reference internal" href="../../reference.html#MeasurementSystem.core.driver.Hardware.Channel_RPI_InternalTemperature.close"><code class="docutils literal notranslate"><span class="pre">close()</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="../../reference.html#MeasurementSystem.core.driver.Hardware.Channel_RPI_InternalTemperature.initialize"><code class="docutils literal notranslate"><span class="pre">initialize()</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="../../reference.html#MeasurementSystem.core.driver.Hardware.Channel_RPI_InternalTemperature.read"><code class="docutils literal notranslate"><span class="pre">read()</span></code></a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="../../reference.html#MeasurementSystem.core.driver.Hardware.Config"><code class="docutils literal notranslate"><span class="pre">Config</span></code></a></li>
<li class="toctree-l3"><a class="reference internal" href="../../reference.html#MeasurementSystem.core.driver.Hardware.Data"><code class="docutils literal notranslate"><span class="pre">Data</span></code></a><ul>
<li class="toctree-l4"><a class="reference internal" href="../../reference.html#MeasurementSystem.core.driver.Hardware.Data.add_value"><code class="docutils literal notranslate"><span class="pre">add_value()</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="../../reference.html#MeasurementSystem.core.driver.Hardware.Data.clear"><code class="docutils literal notranslate"><span class="pre">clear()</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="../../reference.html#MeasurementSystem.core.driver.Hardware.Data.get_all"><code class="docutils literal notranslate"><span class="pre">get_all()</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="../../reference.html#MeasurementSystem.core.driver.Hardware.Data.get_count"><code class="docutils literal notranslate"><span class="pre">get_count()</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="../../reference.html#MeasurementSystem.core.driver.Hardware.Data.get_last"><code class="docutils literal notranslate"><span class="pre">get_last()</span></code></a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="../../reference.html#MeasurementSystem.core.driver.Hardware.Hardware"><code class="docutils literal notranslate"><span class="pre">Hardware</span></code></a><ul>
<li class="toctree-l4"><a class="reference internal" href="../../reference.html#MeasurementSystem.core.driver.Hardware.Hardware.initialize"><code class="docutils literal notranslate"><span class="pre">initialize()</span></code></a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="../../reference.html#MeasurementSystem.core.driver.Hardware.Hardware_DigilentMCC118"><code class="docutils literal notranslate"><span class="pre">Hardware_DigilentMCC118</span></code></a><ul>
<li class="toctree-l4"><a class="reference internal" href="../../reference.html#MeasurementSystem.core.driver.Hardware.Hardware_DigilentMCC118.close"><code class="docutils literal notranslate"><span class="pre">close()</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="../../reference.html#MeasurementSystem.core.driver.Hardware.Hardware_DigilentMCC118.handle"><code class="docutils literal notranslate"><span class="pre">handle</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="../../reference.html#MeasurementSystem.core.driver.Hardware.Hardware_DigilentMCC118.initialize"><code class="docutils literal notranslate"><span class="pre">initialize()</span></code></a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="../../reference.html#MeasurementSystem.core.driver.Hardware.Hardware_DigilentMCC134"><code class="docutils literal notranslate"><span class="pre">Hardware_DigilentMCC134</span></code></a><ul>
<li class="toctree-l4"><a class="reference internal" href="../../reference.html#MeasurementSystem.core.driver.Hardware.Hardware_DigilentMCC134.close"><code class="docutils literal notranslate"><span class="pre">close()</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="../../reference.html#MeasurementSystem.core.driver.Hardware.Hardware_DigilentMCC134.handle"><code class="docutils literal notranslate"><span class="pre">handle</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="../../reference.html#MeasurementSystem.core.driver.Hardware.Hardware_DigilentMCC134.initialize"><code class="docutils literal notranslate"><span class="pre">initialize()</span></code></a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="../../reference.html#MeasurementSystem.core.driver.Hardware.Hardware_RaspberryPi"><code class="docutils literal notranslate"><span class="pre">Hardware_RaspberryPi</span></code></a><ul>
<li class="toctree-l4"><a class="reference internal" href="../../reference.html#MeasurementSystem.core.driver.Hardware.Hardware_RaspberryPi.close"><code class="docutils literal notranslate"><span class="pre">close()</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="../../reference.html#MeasurementSystem.core.driver.Hardware.Hardware_RaspberryPi.handle"><code class="docutils literal notranslate"><span class="pre">handle</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="../../reference.html#MeasurementSystem.core.driver.Hardware.Hardware_RaspberryPi.initialize"><code class="docutils literal notranslate"><span class="pre">initialize()</span></code></a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="../../reference.html#MeasurementSystem.core.driver.Hardware.InputChannel"><code class="docutils literal notranslate"><span class="pre">InputChannel</span></code></a><ul>
<li class="toctree-l4"><a class="reference internal" href="../../reference.html#MeasurementSystem.core.driver.Hardware.InputChannel.read"><code class="docutils literal notranslate"><span class="pre">read()</span></code></a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="../../reference.html#MeasurementSystem.core.driver.Hardware.InputModule"><code class="docutils literal notranslate"><span class="pre">InputModule</span></code></a><ul>
<li class="toctree-l4"><a class="reference internal" href="../../reference.html#MeasurementSystem.core.driver.Hardware.InputModule.read"><code class="docutils literal notranslate"><span class="pre">read()</span></code></a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="../../reference.html#MeasurementSystem.core.driver.Hardware.KTYxModel"><code class="docutils literal notranslate"><span class="pre">KTYxModel</span></code></a><ul>
<li class="toctree-l4"><a class="reference internal" href="../../reference.html#MeasurementSystem.core.driver.Hardware.KTYxModel.apply"><code class="docutils literal notranslate"><span class="pre">apply()</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="../../reference.html#MeasurementSystem.core.driver.Hardware.KTYxModel.to_string"><code class="docutils literal notranslate"><span class="pre">to_string()</span></code></a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="../../reference.html#MeasurementSystem.core.driver.Hardware.LinearModel"><code class="docutils literal notranslate"><span class="pre">LinearModel</span></code></a><ul>
<li class="toctree-l4"><a class="reference internal" href="../../reference.html#MeasurementSystem.core.driver.Hardware.LinearModel.apply"><code class="docutils literal notranslate"><span class="pre">apply()</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="../../reference.html#MeasurementSystem.core.driver.Hardware.LinearModel.to_string"><code class="docutils literal notranslate"><span class="pre">to_string()</span></code></a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="../../reference.html#MeasurementSystem.core.driver.Hardware.Model"><code class="docutils literal notranslate"><span class="pre">Model</span></code></a><ul>
<li class="toctree-l4"><a class="reference internal" href="../../reference.html#MeasurementSystem.core.driver.Hardware.Model.apply"><code class="docutils literal notranslate"><span class="pre">apply()</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="../../reference.html#MeasurementSystem.core.driver.Hardware.Model.parse_model_list"><code class="docutils literal notranslate"><span class="pre">parse_model_list()</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="../../reference.html#MeasurementSystem.core.driver.Hardware.Model.to_string"><code class="docutils literal notranslate"><span class="pre">to_string()</span></code></a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="../../reference.html#MeasurementSystem.core.driver.Hardware.ModelMeta"><code class="docutils literal notranslate"><span class="pre">ModelMeta</span></code></a><ul>
<li class="toctree-l4"><a class="reference internal" href="../../reference.html#MeasurementSystem.core.driver.Hardware.ModelMeta.model_registry"><code class="docutils literal notranslate"><span class="pre">model_registry</span></code></a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="../../reference.html#MeasurementSystem.core.driver.Hardware.Module"><code class="docutils literal notranslate"><span class="pre">Module</span></code></a><ul>
<li class="toctree-l4"><a class="reference internal" href="../../reference.html#MeasurementSystem.core.driver.Hardware.Module.close"><code class="docutils literal notranslate"><span class="pre">close()</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="../../reference.html#MeasurementSystem.core.driver.Hardware.Module.initialize"><code class="docutils literal notranslate"><span class="pre">initialize()</span></code></a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="../../reference.html#MeasurementSystem.core.driver.Hardware.Module_RPI_ServoMotor"><code class="docutils literal notranslate"><span class="pre">Module_RPI_ServoMotor</span></code></a><ul>
<li class="toctree-l4"><a class="reference internal" href="../../reference.html#MeasurementSystem.core.driver.Hardware.Module_RPI_ServoMotor.close"><code class="docutils literal notranslate"><span class="pre">close()</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="../../reference.html#MeasurementSystem.core.driver.Hardware.Module_RPI_ServoMotor.initialize"><code class="docutils literal notranslate"><span class="pre">initialize()</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="../../reference.html#MeasurementSystem.core.driver.Hardware.Module_RPI_ServoMotor.write"><code class="docutils literal notranslate"><span class="pre">write()</span></code></a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="../../reference.html#MeasurementSystem.core.driver.Hardware.Module_RPI_StepperMotor"><code class="docutils literal notranslate"><span class="pre">Module_RPI_StepperMotor</span></code></a><ul>
<li class="toctree-l4"><a class="reference internal" href="../../reference.html#MeasurementSystem.core.driver.Hardware.Module_RPI_StepperMotor.calibrate"><code class="docutils literal notranslate"><span class="pre">calibrate()</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="../../reference.html#MeasurementSystem.core.driver.Hardware.Module_RPI_StepperMotor.close"><code class="docutils literal notranslate"><span class="pre">close()</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="../../reference.html#MeasurementSystem.core.driver.Hardware.Module_RPI_StepperMotor.disable_stepper"><code class="docutils literal notranslate"><span class="pre">disable_stepper()</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="../../reference.html#MeasurementSystem.core.driver.Hardware.Module_RPI_StepperMotor.enable_stepper"><code class="docutils literal notranslate"><span class="pre">enable_stepper()</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="../../reference.html#MeasurementSystem.core.driver.Hardware.Module_RPI_StepperMotor.getPosition"><code class="docutils literal notranslate"><span class="pre">getPosition()</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="../../reference.html#MeasurementSystem.core.driver.Hardware.Module_RPI_StepperMotor.initialize"><code class="docutils literal notranslate"><span class="pre">initialize()</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="../../reference.html#MeasurementSystem.core.driver.Hardware.Module_RPI_StepperMotor.setDirection"><code class="docutils literal notranslate"><span class="pre">setDirection()</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="../../reference.html#MeasurementSystem.core.driver.Hardware.Module_RPI_StepperMotor.write"><code class="docutils literal notranslate"><span class="pre">write()</span></code></a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="../../reference.html#MeasurementSystem.core.driver.Hardware.Module_RPI_WeighScalesHX711"><code class="docutils literal notranslate"><span class="pre">Module_RPI_WeighScalesHX711</span></code></a><ul>
<li class="toctree-l4"><a class="reference internal" href="../../reference.html#MeasurementSystem.core.driver.Hardware.Module_RPI_WeighScalesHX711.ReadType"><code class="docutils literal notranslate"><span class="pre">ReadType</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="../../reference.html#MeasurementSystem.core.driver.Hardware.Module_RPI_WeighScalesHX711.close"><code class="docutils literal notranslate"><span class="pre">close()</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="../../reference.html#MeasurementSystem.core.driver.Hardware.Module_RPI_WeighScalesHX711.initialize"><code class="docutils literal notranslate"><span class="pre">initialize()</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="../../reference.html#MeasurementSystem.core.driver.Hardware.Module_RPI_WeighScalesHX711.powerDown"><code class="docutils literal notranslate"><span class="pre">powerDown()</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="../../reference.html#MeasurementSystem.core.driver.Hardware.Module_RPI_WeighScalesHX711.read"><code class="docutils literal notranslate"><span class="pre">read()</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="../../reference.html#MeasurementSystem.core.driver.Hardware.Module_RPI_WeighScalesHX711.readAverage"><code class="docutils literal notranslate"><span class="pre">readAverage()</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="../../reference.html#MeasurementSystem.core.driver.Hardware.Module_RPI_WeighScalesHX711.readMedian"><code class="docutils literal notranslate"><span class="pre">readMedian()</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="../../reference.html#MeasurementSystem.core.driver.Hardware.Module_RPI_WeighScalesHX711.readRaw"><code class="docutils literal notranslate"><span class="pre">readRaw()</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="../../reference.html#MeasurementSystem.core.driver.Hardware.Module_RPI_WeighScalesHX711.wakeup"><code class="docutils literal notranslate"><span class="pre">wakeup()</span></code></a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="../../reference.html#MeasurementSystem.core.driver.Hardware.MultiChannel"><code class="docutils literal notranslate"><span class="pre">MultiChannel</span></code></a><ul>
<li class="toctree-l4"><a class="reference internal" href="../../reference.html#MeasurementSystem.core.driver.Hardware.MultiChannel.close"><code class="docutils literal notranslate"><span class="pre">close()</span></code></a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="../../reference.html#MeasurementSystem.core.driver.Hardware.MultiHardware"><code class="docutils literal notranslate"><span class="pre">MultiHardware</span></code></a><ul>
<li class="toctree-l4"><a class="reference internal" href="../../reference.html#MeasurementSystem.core.driver.Hardware.MultiHardware.add_hardware"><code class="docutils literal notranslate"><span class="pre">add_hardware()</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="../../reference.html#MeasurementSystem.core.driver.Hardware.MultiHardware.close"><code class="docutils literal notranslate"><span class="pre">close()</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="../../reference.html#MeasurementSystem.core.driver.Hardware.MultiHardware.get_channels"><code class="docutils literal notranslate"><span class="pre">get_channels()</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="../../reference.html#MeasurementSystem.core.driver.Hardware.MultiHardware.get_channels_by_name"><code class="docutils literal notranslate"><span class="pre">get_channels_by_name()</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="../../reference.html#MeasurementSystem.core.driver.Hardware.MultiHardware.get_channels_by_type"><code class="docutils literal notranslate"><span class="pre">get_channels_by_type()</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="../../reference.html#MeasurementSystem.core.driver.Hardware.MultiHardware.get_hardware"><code class="docutils literal notranslate"><span class="pre">get_hardware()</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="../../reference.html#MeasurementSystem.core.driver.Hardware.MultiHardware.get_hardware_by_name"><code class="docutils literal notranslate"><span class="pre">get_hardware_by_name()</span></code></a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="../../reference.html#MeasurementSystem.core.driver.Hardware.NTCModel"><code class="docutils literal notranslate"><span class="pre">NTCModel</span></code></a><ul>
<li class="toctree-l4"><a class="reference internal" href="../../reference.html#MeasurementSystem.core.driver.Hardware.NTCModel.apply"><code class="docutils literal notranslate"><span class="pre">apply()</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="../../reference.html#MeasurementSystem.core.driver.Hardware.NTCModel.to_string"><code class="docutils literal notranslate"><span class="pre">to_string()</span></code></a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="../../reference.html#MeasurementSystem.core.driver.Hardware.OutputChannel"><code class="docutils literal notranslate"><span class="pre">OutputChannel</span></code></a><ul>
<li class="toctree-l4"><a class="reference internal" href="../../reference.html#MeasurementSystem.core.driver.Hardware.OutputChannel.write"><code class="docutils literal notranslate"><span class="pre">write()</span></code></a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="../../reference.html#MeasurementSystem.core.driver.Hardware.OutputModule"><code class="docutils literal notranslate"><span class="pre">OutputModule</span></code></a><ul>
<li class="toctree-l4"><a class="reference internal" href="../../reference.html#MeasurementSystem.core.driver.Hardware.OutputModule.write"><code class="docutils literal notranslate"><span class="pre">write()</span></code></a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="../../reference.html#MeasurementSystem.core.driver.Hardware.PTxModel"><code class="docutils literal notranslate"><span class="pre">PTxModel</span></code></a><ul>
<li class="toctree-l4"><a class="reference internal" href="../../reference.html#MeasurementSystem.core.driver.Hardware.PTxModel.apply"><code class="docutils literal notranslate"><span class="pre">apply()</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="../../reference.html#MeasurementSystem.core.driver.Hardware.PTxModel.to_string"><code class="docutils literal notranslate"><span class="pre">to_string()</span></code></a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="../../reference.html#MeasurementSystem.core.driver.Hardware.Serializable"><code class="docutils literal notranslate"><span class="pre">Serializable</span></code></a><ul>
<li class="toctree-l4"><a class="reference internal" href="../../reference.html#MeasurementSystem.core.driver.Hardware.Serializable.from_dict"><code class="docutils literal notranslate"><span class="pre">from_dict()</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="../../reference.html#MeasurementSystem.core.driver.Hardware.Serializable.to_dict"><code class="docutils literal notranslate"><span class="pre">to_dict()</span></code></a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="../../reference.html#MeasurementSystem.core.driver.Hardware.StackedModel"><code class="docutils literal notranslate"><span class="pre">StackedModel</span></code></a><ul>
<li class="toctree-l4"><a class="reference internal" href="../../reference.html#MeasurementSystem.core.driver.Hardware.StackedModel.apply"><code class="docutils literal notranslate"><span class="pre">apply()</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="../../reference.html#MeasurementSystem.core.driver.Hardware.StackedModel.to_string"><code class="docutils literal notranslate"><span class="pre">to_string()</span></code></a></li>
</ul>
</li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="../../reference.html#communication-visualization">Communication &amp; Visualization</a><ul>
<li class="toctree-l3"><a class="reference internal" href="../../reference.html#module-MeasurementSystem.core.comvisu.Command">Command Module</a><ul>
<li class="toctree-l4"><a class="reference internal" href="../../reference.html#MeasurementSystem.core.comvisu.Command.Command"><code class="docutils literal notranslate"><span class="pre">Command</span></code></a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="../../reference.html#module-MeasurementSystem.core.comvisu.ServerUtils">Server Utilities</a><ul>
<li class="toctree-l4"><a class="reference internal" href="../../reference.html#MeasurementSystem.core.comvisu.ServerUtils.DataQueueThread"><code class="docutils literal notranslate"><span class="pre">DataQueueThread</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="../../reference.html#MeasurementSystem.core.comvisu.ServerUtils.ServerConnection"><code class="docutils literal notranslate"><span class="pre">ServerConnection</span></code></a></li>
</ul>
</li>
</ul>
</li>
</ul>
</li>
</ul>

        </div>
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap"><nav class="wy-nav-top" aria-label="Mobile navigation menu"  style="background: #2980b9" >
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="../../index.html">Measurement System</a>
      </nav>

      <div class="wy-nav-content">
        <div class="rst-content">
          <div role="navigation" aria-label="Page navigation">
  <ul class="wy-breadcrumbs">
      <li><a href="../../index.html" class="icon icon-home" aria-label="Home"></a></li>
          <li class="breadcrumb-item"><a href="../index.html">Module code</a></li>
      <li class="breadcrumb-item active">MeasurementSystem.measurement_server</li>
      <li class="wy-breadcrumbs-aside">
      </li>
  </ul>
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">

  <h1>Source code for MeasurementSystem.measurement_server</h1><div class="highlight"><pre>
<span></span><span class="kn">from</span> <span class="nn">__future__</span> <span class="kn">import</span> <span class="n">annotations</span>

<span class="kn">import</span> <span class="nn">importlib</span>
<span class="kn">import</span> <span class="nn">json</span>
<span class="kn">import</span> <span class="nn">os</span>
<span class="kn">import</span> <span class="nn">queue</span>
<span class="kn">import</span> <span class="nn">sys</span>
<span class="kn">import</span> <span class="nn">threading</span>
<span class="kn">import</span> <span class="nn">time</span>
<span class="kn">import</span> <span class="nn">traceback</span>
<span class="kn">from</span> <span class="nn">concurrent.futures</span> <span class="kn">import</span> <span class="n">ThreadPoolExecutor</span><span class="p">,</span> <span class="n">as_completed</span>
<span class="kn">from</span> <span class="nn">datetime</span> <span class="kn">import</span> <span class="n">datetime</span>
<span class="kn">from</span> <span class="nn">typing</span> <span class="kn">import</span> <span class="n">Any</span><span class="p">,</span> <span class="n">Dict</span><span class="p">,</span> <span class="n">List</span><span class="p">,</span> <span class="n">Protocol</span><span class="p">,</span> <span class="n">Union</span>

<span class="kn">from</span> <span class="nn">MeasurementSystem.core.comvisu.Command</span> <span class="kn">import</span> <span class="n">Command</span>
<span class="kn">from</span> <span class="nn">MeasurementSystem.core.comvisu.ServerUtils</span> <span class="kn">import</span> <span class="n">DataQueueThread</span><span class="p">,</span> <span class="n">ServerConnection</span>
<span class="kn">from</span> <span class="nn">MeasurementSystem.core.driver.Hardware</span> <span class="kn">import</span> <span class="p">(</span>
    <span class="n">Channel</span><span class="p">,</span>
    <span class="n">Channel_MCC118_VoltageChannel</span><span class="p">,</span>
    <span class="n">Channel_RPI_DigitalOutput</span><span class="p">,</span>
    <span class="n">Channel_RPI_FrequencyCounter</span><span class="p">,</span>
    <span class="n">Channel_RPI_InternalTemperature</span><span class="p">,</span>
    <span class="n">Hardware_DigilentMCC118</span><span class="p">,</span>
    <span class="n">Hardware_RaspberryPi</span><span class="p">,</span>
    <span class="n">InputChannel</span><span class="p">,</span>
    <span class="n">InputModule</span><span class="p">,</span>
    <span class="n">LinearModel</span><span class="p">,</span>
    <span class="n">Module</span><span class="p">,</span>
    <span class="n">Module_RPI_StepperMotor</span><span class="p">,</span>
    <span class="n">Module_RPI_WeighScalesHX711</span><span class="p">,</span>
    <span class="n">MultiHardware</span><span class="p">,</span>
    <span class="n">Serializable</span><span class="p">,</span>
<span class="p">)</span>
<span class="kn">from</span> <span class="nn">MeasurementSystem.core.Utils</span> <span class="kn">import</span> <span class="n">OrderedPriorityQueue</span>

<span class="n">current_dir</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">dirname</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">realpath</span><span class="p">(</span><span class="vm">__file__</span><span class="p">))</span>

<span class="n">LOCKFILE</span> <span class="o">=</span> <span class="s2">&quot;/tmp/measurement_server.lock&quot;</span>

<span class="n">default_server_address</span> <span class="o">=</span> <span class="p">(</span><span class="s2">&quot;192.168.1.31&quot;</span><span class="p">,</span> <span class="mi">8008</span><span class="p">)</span>


<div class="viewcode-block" id="HardwareInterface">
<a class="viewcode-back" href="../../reference.html#MeasurementSystem.measurement_server.HardwareInterface">[docs]</a>
<span class="k">class</span> <span class="nc">HardwareInterface</span><span class="p">(</span><span class="n">Serializable</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    A class representing the hardware interface.</span>

<span class="sd">    This class provides a way to manage and interact with the hardware interface.</span>

<span class="sd">    :param name: The name of the hardware interface.</span>
<span class="sd">    :type name: str</span>

<span class="sd">    :return: HardwareInterface instance</span>
<span class="sd">    :rtype: HardwareInterface</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">name</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">name</span> <span class="o">=</span> <span class="n">name</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">multi_hardware</span> <span class="o">=</span> <span class="n">MultiHardware</span><span class="p">(</span><span class="n">name</span><span class="o">=</span><span class="s2">&quot;MeasurementSystem&quot;</span><span class="p">)</span>

<div class="viewcode-block" id="HardwareInterface.initialize">
<a class="viewcode-back" href="../../reference.html#MeasurementSystem.measurement_server.HardwareInterface.initialize">[docs]</a>
    <span class="k">def</span> <span class="nf">initialize</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
        <span class="c1"># Hardware: Raspberry Pi 5</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Initialize the hardware interface.</span>

<span class="sd">        :return: None</span>
<span class="sd">        :rtype: None</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="n">_rpi_hardware</span> <span class="o">=</span> <span class="n">Hardware_RaspberryPi</span><span class="p">(</span><span class="n">name</span><span class="o">=</span><span class="s2">&quot;RPI5&quot;</span><span class="p">)</span>

        <span class="n">rpi_input_channels</span> <span class="o">=</span> <span class="p">[</span>
            <span class="n">Channel_RPI_FrequencyCounter</span><span class="p">(</span>
                <span class="n">handle</span><span class="o">=</span><span class="n">_rpi_hardware</span><span class="o">.</span><span class="n">handle</span><span class="p">,</span>
                <span class="n">name</span><span class="o">=</span><span class="s2">&quot;Speed1&quot;</span><span class="p">,</span>
                <span class="n">pin</span><span class="o">=</span><span class="mi">18</span><span class="p">,</span>
                <span class="n">unit</span><span class="o">=</span><span class="s2">&quot;rpm&quot;</span><span class="p">,</span>
                <span class="n">model</span><span class="o">=</span><span class="n">LinearModel</span><span class="p">(</span><span class="n">offset</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="n">gain</span><span class="o">=</span><span class="mi">1</span><span class="p">),</span>
                <span class="n">sample_rate</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span>
                <span class="n">chart_number</span><span class="o">=</span><span class="mi">701</span><span class="p">,</span>
                <span class="n">enabled</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
            <span class="p">),</span>
            <span class="n">Channel_RPI_InternalTemperature</span><span class="p">(</span>
                <span class="n">name</span><span class="o">=</span><span class="s2">&quot;Temperature&quot;</span><span class="p">,</span>
                <span class="n">unit</span><span class="o">=</span><span class="s2">&quot;C&quot;</span><span class="p">,</span>
                <span class="n">model</span><span class="o">=</span><span class="n">LinearModel</span><span class="p">(</span><span class="n">offset</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="n">gain</span><span class="o">=</span><span class="mi">1</span><span class="p">),</span>
                <span class="n">sample_rate</span><span class="o">=</span><span class="mi">2</span><span class="p">,</span>
                <span class="n">chart_number</span><span class="o">=</span><span class="mi">729</span><span class="p">,</span>
                <span class="n">enabled</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
            <span class="p">),</span>
            <span class="n">Channel_RPI_DigitalOutput</span><span class="p">(</span><span class="n">handle</span><span class="o">=</span><span class="n">_rpi_hardware</span><span class="o">.</span><span class="n">handle</span><span class="p">,</span> <span class="n">name</span><span class="o">=</span><span class="s2">&quot;KeepAliveLED&quot;</span><span class="p">,</span> <span class="n">pin</span><span class="o">=</span><span class="mi">19</span><span class="p">,</span> <span class="n">enabled</span><span class="o">=</span><span class="kc">True</span><span class="p">),</span>
        <span class="p">]</span>
        <span class="n">_rpi_hardware</span><span class="o">.</span><span class="n">add_channels</span><span class="p">(</span><span class="n">rpi_input_channels</span><span class="p">)</span>

        <span class="n">rpi_multi_channels</span> <span class="o">=</span> <span class="p">[</span>
            <span class="n">Module_RPI_StepperMotor</span><span class="p">(</span>
                <span class="n">handle</span><span class="o">=</span><span class="n">_rpi_hardware</span><span class="o">.</span><span class="n">handle</span><span class="p">,</span>
                <span class="n">name</span><span class="o">=</span><span class="s2">&quot;StepperMotor&quot;</span><span class="p">,</span>
                <span class="n">step_pin</span><span class="o">=</span><span class="mi">24</span><span class="p">,</span>
                <span class="n">dir_pin</span><span class="o">=</span><span class="mi">25</span><span class="p">,</span>
                <span class="n">enable_pin</span><span class="o">=</span><span class="mi">16</span><span class="p">,</span>
                <span class="n">limitA_pin</span><span class="o">=</span><span class="mi">20</span><span class="p">,</span>
                <span class="n">limitB_pin</span><span class="o">=</span><span class="mi">21</span><span class="p">,</span>
                <span class="n">enabled</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
            <span class="p">),</span>
            <span class="n">Module_RPI_WeighScalesHX711</span><span class="p">(</span>
                <span class="n">handle</span><span class="o">=</span><span class="n">_rpi_hardware</span><span class="o">.</span><span class="n">handle</span><span class="p">,</span>
                <span class="n">name</span><span class="o">=</span><span class="s2">&quot;HX711&quot;</span><span class="p">,</span>
                <span class="n">data_pin</span><span class="o">=</span><span class="mi">5</span><span class="p">,</span>
                <span class="n">clock_pin</span><span class="o">=</span><span class="mi">6</span><span class="p">,</span>
                <span class="n">model</span><span class="o">=</span><span class="n">LinearModel</span><span class="p">(</span><span class="n">offset</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="n">gain</span><span class="o">=</span><span class="mi">1</span><span class="p">),</span>
                <span class="n">sample_rate</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span>
                <span class="n">chart_number</span><span class="o">=</span><span class="mi">745</span><span class="p">,</span>
                <span class="n">enabled</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
            <span class="p">),</span>
        <span class="p">]</span>
        <span class="n">_rpi_hardware</span><span class="o">.</span><span class="n">add_channels</span><span class="p">(</span><span class="n">rpi_multi_channels</span><span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">multi_hardware</span><span class="o">.</span><span class="n">add_hardware</span><span class="p">(</span><span class="n">_rpi_hardware</span><span class="p">)</span>

        <span class="c1"># Hardware: Digilent MCC118</span>
        <span class="n">_mcc118_hardware</span> <span class="o">=</span> <span class="n">Hardware_DigilentMCC118</span><span class="p">(</span><span class="n">name</span><span class="o">=</span><span class="s2">&quot;MCC118&quot;</span><span class="p">,</span> <span class="n">hat_address</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span>

        <span class="n">mcc118_input_channels</span> <span class="o">=</span> <span class="p">[</span>
            <span class="n">Channel_MCC118_VoltageChannel</span><span class="p">(</span>
                <span class="n">handle</span><span class="o">=</span><span class="n">_mcc118_hardware</span><span class="o">.</span><span class="n">_handle</span><span class="p">,</span>
                <span class="n">channel</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span>
                <span class="n">name</span><span class="o">=</span><span class="s2">&quot;MCC118_0&quot;</span><span class="p">,</span>
                <span class="n">unit</span><span class="o">=</span><span class="s2">&quot;V&quot;</span><span class="p">,</span>
                <span class="n">model</span><span class="o">=</span><span class="n">LinearModel</span><span class="p">(</span><span class="n">offset</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="n">gain</span><span class="o">=</span><span class="mi">1</span><span class="p">),</span>
                <span class="n">sample_rate</span><span class="o">=</span><span class="mf">0.5</span><span class="p">,</span>
                <span class="n">chart_number</span><span class="o">=</span><span class="mi">767</span><span class="p">,</span>
                <span class="n">enabled</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
            <span class="p">),</span>
            <span class="n">Channel_MCC118_VoltageChannel</span><span class="p">(</span>
                <span class="n">handle</span><span class="o">=</span><span class="n">_mcc118_hardware</span><span class="o">.</span><span class="n">_handle</span><span class="p">,</span>
                <span class="n">channel</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span>
                <span class="n">name</span><span class="o">=</span><span class="s2">&quot;MCC118_1&quot;</span><span class="p">,</span>
                <span class="n">unit</span><span class="o">=</span><span class="s2">&quot;V&quot;</span><span class="p">,</span>
                <span class="n">model</span><span class="o">=</span><span class="n">LinearModel</span><span class="p">(</span><span class="n">offset</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="n">gain</span><span class="o">=</span><span class="mi">1</span><span class="p">),</span>
                <span class="n">sample_rate</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span>
                <span class="n">chart_number</span><span class="o">=</span><span class="mi">781</span><span class="p">,</span>
                <span class="n">enabled</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
            <span class="p">),</span>
            <span class="n">Channel_MCC118_VoltageChannel</span><span class="p">(</span>
                <span class="n">handle</span><span class="o">=</span><span class="n">_mcc118_hardware</span><span class="o">.</span><span class="n">_handle</span><span class="p">,</span>
                <span class="n">channel</span><span class="o">=</span><span class="mi">2</span><span class="p">,</span>
                <span class="n">name</span><span class="o">=</span><span class="s2">&quot;MCC118_2&quot;</span><span class="p">,</span>
                <span class="n">unit</span><span class="o">=</span><span class="s2">&quot;V&quot;</span><span class="p">,</span>
                <span class="n">model</span><span class="o">=</span><span class="n">LinearModel</span><span class="p">(</span><span class="n">offset</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="n">gain</span><span class="o">=</span><span class="mi">1</span><span class="p">),</span>
                <span class="n">sample_rate</span><span class="o">=</span><span class="mi">2</span><span class="p">,</span>
                <span class="n">chart_number</span><span class="o">=</span><span class="mi">789</span><span class="p">,</span>
                <span class="n">enabled</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
            <span class="p">),</span>
        <span class="p">]</span>

        <span class="n">_mcc118_hardware</span><span class="o">.</span><span class="n">add_channels</span><span class="p">(</span><span class="n">mcc118_input_channels</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">multi_hardware</span><span class="o">.</span><span class="n">add_hardware</span><span class="p">(</span><span class="n">_mcc118_hardware</span><span class="p">)</span></div>


<div class="viewcode-block" id="HardwareInterface.close">
<a class="viewcode-back" href="../../reference.html#MeasurementSystem.measurement_server.HardwareInterface.close">[docs]</a>
    <span class="k">def</span> <span class="nf">close</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Close the hardware interface.</span>

<span class="sd">        This method will close the hardware interface and remove all hardware</span>
<span class="sd">        instances from the internal list. This is necessary to prevent a memory</span>
<span class="sd">        leak when the hardware interface is recreated.</span>

<span class="sd">        :return: None</span>
<span class="sd">        :rtype: None</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">multi_hardware</span><span class="o">.</span><span class="n">close</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">multi_hardware</span><span class="o">.</span><span class="n">hardware_list</span><span class="o">.</span><span class="n">clear</span><span class="p">()</span>  <span class="c1"># NOTE: this may fix the bug????</span></div>


    <span class="c1">############################</span>
    <span class="c1"># JSON Serialization</span>
    <span class="c1">#</span>
<div class="viewcode-block" id="HardwareInterface.to_json">
<a class="viewcode-back" href="../../reference.html#MeasurementSystem.measurement_server.HardwareInterface.to_json">[docs]</a>
    <span class="k">def</span> <span class="nf">to_json</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span>
        <span class="n">hardware_file</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="s2">&quot;hardware.json&quot;</span><span class="p">,</span>
        <span class="n">channels_file</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="s2">&quot;channels.json&quot;</span><span class="p">,</span>
        <span class="n">modules_file</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="s2">&quot;modules.json&quot;</span><span class="p">,</span>
    <span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Serialize the hardware interface to JSON files.</span>

<span class="sd">        This method will serialize the hardware interface to three JSON files: one</span>
<span class="sd">        for hardware, one for channels, and one for modules. The JSON files will be</span>
<span class="sd">        saved in the current working directory.</span>

<span class="sd">        The hardware file will contain a list of dictionaries, each representing a</span>
<span class="sd">        hardware object. The dictionaries will contain the hardware object&#39;s</span>
<span class="sd">        attributes, excluding any attributes that are lists or dicts containing</span>
<span class="sd">        Channel instances.</span>

<span class="sd">        The channels file will contain a list of dictionaries, each representing a</span>
<span class="sd">        channel object. The dictionaries will contain the channel object&#39;s</span>
<span class="sd">        attributes, including a reference to the parent hardware object.</span>

<span class="sd">        The modules file will contain a list of dictionaries, each representing a</span>
<span class="sd">        module object. The dictionaries will contain the module object&#39;s</span>
<span class="sd">        attributes, including a reference to the parent hardware object.</span>

<span class="sd">        :param hardware_file: The filename for the hardware file. Defaults to</span>
<span class="sd">            &quot;hardware.json&quot;.</span>
<span class="sd">        :type hardware_file: str</span>
<span class="sd">        :param channels_file: The filename for the channels file. Defaults to</span>
<span class="sd">            &quot;channels.json&quot;.</span>
<span class="sd">        :type channels_file: str</span>
<span class="sd">        :param modules_file: The filename for the modules file. Defaults to</span>
<span class="sd">            &quot;modules.json&quot;.</span>
<span class="sd">        :type modules_file: str</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="n">hardware_objects</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="n">channel_objects</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="n">module_objects</span> <span class="o">=</span> <span class="p">[]</span>

        <span class="c1"># Iterate over hardware and extract channels separately</span>
        <span class="k">for</span> <span class="n">hw</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">multi_hardware</span><span class="o">.</span><span class="n">hardware_list</span><span class="p">:</span>
            <span class="c1"># Convert hardware object to dictionary but exclude channels</span>
            <span class="n">hardware_dict</span> <span class="o">=</span> <span class="n">hw</span><span class="o">.</span><span class="n">to_dict</span><span class="p">()</span>

            <span class="c1"># Remove attributes that are lists or dicts containing Channel instances</span>
            <span class="k">def</span> <span class="nf">exclude_channels_and_modules</span><span class="p">(</span><span class="n">d</span><span class="p">):</span>
                <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">d</span><span class="p">,</span> <span class="nb">dict</span><span class="p">):</span>
                    <span class="n">result</span> <span class="o">=</span> <span class="p">{}</span>
                    <span class="k">for</span> <span class="n">k</span><span class="p">,</span> <span class="n">v</span> <span class="ow">in</span> <span class="n">d</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
                        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">v</span><span class="p">,</span> <span class="nb">list</span><span class="p">):</span>
                            <span class="c1"># Skip lists that contain Channel or Module instances</span>
                            <span class="k">if</span> <span class="nb">any</span><span class="p">(</span><span class="nb">isinstance</span><span class="p">(</span><span class="n">item</span><span class="p">,</span> <span class="p">(</span><span class="n">Channel</span><span class="p">,</span> <span class="n">Module</span><span class="p">))</span> <span class="k">for</span> <span class="n">item</span> <span class="ow">in</span> <span class="n">v</span><span class="p">):</span>
                                <span class="k">continue</span>
                            <span class="n">result</span><span class="p">[</span><span class="n">k</span><span class="p">]</span> <span class="o">=</span> <span class="n">exclude_channels_and_modules</span><span class="p">(</span><span class="n">v</span><span class="p">)</span>
                        <span class="k">elif</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">v</span><span class="p">,</span> <span class="nb">dict</span><span class="p">):</span>
                            <span class="n">result</span><span class="p">[</span><span class="n">k</span><span class="p">]</span> <span class="o">=</span> <span class="n">exclude_channels_and_modules</span><span class="p">(</span><span class="n">v</span><span class="p">)</span>
                        <span class="k">else</span><span class="p">:</span>
                            <span class="n">result</span><span class="p">[</span><span class="n">k</span><span class="p">]</span> <span class="o">=</span> <span class="n">v</span>
                    <span class="k">return</span> <span class="n">result</span>
                <span class="k">return</span> <span class="n">d</span>

            <span class="n">hardware_dict</span><span class="p">[</span><span class="s2">&quot;attributes&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">exclude_channels_and_modules</span><span class="p">(</span><span class="n">hardware_dict</span><span class="p">[</span><span class="s2">&quot;attributes&quot;</span><span class="p">])</span>
            <span class="n">hardware_objects</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">hardware_dict</span><span class="p">)</span>

            <span class="c1"># Extract and serialize channels</span>
            <span class="k">for</span> <span class="n">channel</span> <span class="ow">in</span> <span class="n">hw</span><span class="o">.</span><span class="n">get_channels</span><span class="p">():</span>
                <span class="k">if</span> <span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">channel</span><span class="p">,</span> <span class="n">Module</span><span class="p">):</span>
                    <span class="n">channel_dict</span> <span class="o">=</span> <span class="n">channel</span><span class="o">.</span><span class="n">to_dict</span><span class="p">()</span>
                    <span class="n">channel_dict</span><span class="p">[</span><span class="s2">&quot;parent_hardware&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="p">{</span>
                        <span class="s2">&quot;id&quot;</span><span class="p">:</span> <span class="nb">id</span><span class="p">(</span><span class="n">hw</span><span class="p">),</span>
                        <span class="s2">&quot;name&quot;</span><span class="p">:</span> <span class="n">hw</span><span class="o">.</span><span class="n">name</span><span class="p">,</span>
                        <span class="s2">&quot;class&quot;</span><span class="p">:</span> <span class="n">hw</span><span class="o">.</span><span class="vm">__class__</span><span class="o">.</span><span class="vm">__name__</span><span class="p">,</span>
                        <span class="s2">&quot;module&quot;</span><span class="p">:</span> <span class="n">hw</span><span class="o">.</span><span class="vm">__module__</span><span class="p">,</span>
                    <span class="p">}</span>
                    <span class="n">channel_objects</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">channel_dict</span><span class="p">)</span>

            <span class="c1"># Extract and serialize modules</span>
            <span class="k">for</span> <span class="n">module</span> <span class="ow">in</span> <span class="n">hw</span><span class="o">.</span><span class="n">get_modules</span><span class="p">():</span>
                <span class="n">module_dict</span> <span class="o">=</span> <span class="n">module</span><span class="o">.</span><span class="n">to_dict</span><span class="p">()</span>
                <span class="n">module_dict</span><span class="p">[</span><span class="s2">&quot;parent_hardware&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="p">{</span>
                    <span class="s2">&quot;id&quot;</span><span class="p">:</span> <span class="nb">id</span><span class="p">(</span><span class="n">hw</span><span class="p">),</span>
                    <span class="s2">&quot;name&quot;</span><span class="p">:</span> <span class="n">hw</span><span class="o">.</span><span class="n">name</span><span class="p">,</span>
                    <span class="s2">&quot;class&quot;</span><span class="p">:</span> <span class="n">hw</span><span class="o">.</span><span class="vm">__class__</span><span class="o">.</span><span class="vm">__name__</span><span class="p">,</span>
                    <span class="s2">&quot;module&quot;</span><span class="p">:</span> <span class="n">hw</span><span class="o">.</span><span class="vm">__module__</span><span class="p">,</span>
                <span class="p">}</span>
                <span class="n">module_objects</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">module_dict</span><span class="p">)</span>

        <span class="c1"># Save to JSON files</span>
        <span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="n">hardware_file</span><span class="p">,</span> <span class="s2">&quot;w&quot;</span><span class="p">)</span> <span class="k">as</span> <span class="n">f</span><span class="p">:</span>
            <span class="n">json</span><span class="o">.</span><span class="n">dump</span><span class="p">(</span>
                <span class="n">hardware_objects</span><span class="p">,</span>
                <span class="n">f</span><span class="p">,</span>
                <span class="n">indent</span><span class="o">=</span><span class="mi">4</span><span class="p">,</span>
                <span class="n">default</span><span class="o">=</span><span class="k">lambda</span> <span class="n">o</span><span class="p">:</span> <span class="n">o</span><span class="o">.</span><span class="n">to_dict</span><span class="p">()</span> <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">o</span><span class="p">,</span> <span class="n">Serializable</span><span class="p">)</span> <span class="k">else</span> <span class="kc">None</span><span class="p">,</span>
            <span class="p">)</span>

        <span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="n">channels_file</span><span class="p">,</span> <span class="s2">&quot;w&quot;</span><span class="p">)</span> <span class="k">as</span> <span class="n">f</span><span class="p">:</span>
            <span class="n">json</span><span class="o">.</span><span class="n">dump</span><span class="p">(</span>
                <span class="n">channel_objects</span><span class="p">,</span>
                <span class="n">f</span><span class="p">,</span>
                <span class="n">indent</span><span class="o">=</span><span class="mi">4</span><span class="p">,</span>
                <span class="n">default</span><span class="o">=</span><span class="k">lambda</span> <span class="n">o</span><span class="p">:</span> <span class="n">o</span><span class="o">.</span><span class="n">to_dict</span><span class="p">()</span> <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">o</span><span class="p">,</span> <span class="n">Serializable</span><span class="p">)</span> <span class="k">else</span> <span class="kc">None</span><span class="p">,</span>
            <span class="p">)</span>

        <span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="n">modules_file</span><span class="p">,</span> <span class="s2">&quot;w&quot;</span><span class="p">)</span> <span class="k">as</span> <span class="n">f</span><span class="p">:</span>
            <span class="n">json</span><span class="o">.</span><span class="n">dump</span><span class="p">(</span>
                <span class="n">module_objects</span><span class="p">,</span>
                <span class="n">f</span><span class="p">,</span>
                <span class="n">indent</span><span class="o">=</span><span class="mi">4</span><span class="p">,</span>
                <span class="n">default</span><span class="o">=</span><span class="k">lambda</span> <span class="n">o</span><span class="p">:</span> <span class="n">o</span><span class="o">.</span><span class="n">to_dict</span><span class="p">()</span> <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">o</span><span class="p">,</span> <span class="n">Serializable</span><span class="p">)</span> <span class="k">else</span> <span class="kc">None</span><span class="p">,</span>
            <span class="p">)</span></div>


<div class="viewcode-block" id="HardwareInterface.from_json">
<a class="viewcode-back" href="../../reference.html#MeasurementSystem.measurement_server.HardwareInterface.from_json">[docs]</a>
    <span class="nd">@classmethod</span>
    <span class="k">def</span> <span class="nf">from_json</span><span class="p">(</span>
        <span class="bp">cls</span><span class="p">,</span>
        <span class="n">hardware_file</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="s2">&quot;hardware.json&quot;</span><span class="p">,</span>
        <span class="n">channels_file</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="s2">&quot;channels.json&quot;</span><span class="p">,</span>
        <span class="n">modules_file</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="s2">&quot;modules.json&quot;</span><span class="p">,</span>
    <span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Restore a HardwareInterface from JSON files.</span>

<span class="sd">        :param hardware_file: The filename for the hardware file. Defaults to</span>
<span class="sd">            &quot;hardware.json&quot;.</span>
<span class="sd">        :type hardware_file: str</span>
<span class="sd">        :param channels_file: The filename for the channels file. Defaults to</span>
<span class="sd">            &quot;channels.json&quot;.</span>
<span class="sd">        :type channels_file: str</span>
<span class="sd">        :param modules_file: The filename for the modules file. Defaults to</span>
<span class="sd">            &quot;modules.json&quot;.</span>
<span class="sd">        :type modules_file: str</span>

<span class="sd">        :return: A restored HardwareInterface instance.</span>
<span class="sd">        :rtype: HardwareInterface</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="n">hardware_file</span><span class="p">)</span> <span class="k">as</span> <span class="n">f</span><span class="p">:</span>
            <span class="n">hardware_data</span> <span class="o">=</span> <span class="n">json</span><span class="o">.</span><span class="n">load</span><span class="p">(</span><span class="n">f</span><span class="p">)</span>

        <span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="n">channels_file</span><span class="p">)</span> <span class="k">as</span> <span class="n">f</span><span class="p">:</span>
            <span class="n">channel_data</span> <span class="o">=</span> <span class="n">json</span><span class="o">.</span><span class="n">load</span><span class="p">(</span><span class="n">f</span><span class="p">)</span>

        <span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="n">modules_file</span><span class="p">)</span> <span class="k">as</span> <span class="n">f</span><span class="p">:</span>
            <span class="n">module_data</span> <span class="o">=</span> <span class="n">json</span><span class="o">.</span><span class="n">load</span><span class="p">(</span><span class="n">f</span><span class="p">)</span>

        <span class="c1"># Create a HardwareInterface instance</span>
        <span class="n">instance</span> <span class="o">=</span> <span class="bp">cls</span><span class="p">(</span><span class="n">name</span><span class="o">=</span><span class="s2">&quot;RestoredHardwareInterface&quot;</span><span class="p">)</span>

        <span class="c1"># Deserialize hardware</span>
        <span class="n">hardware_references</span> <span class="o">=</span> <span class="p">{}</span>
        <span class="n">hardware_objects</span> <span class="o">=</span> <span class="p">[</span><span class="n">Serializable</span><span class="o">.</span><span class="n">from_dict</span><span class="p">(</span><span class="n">item</span><span class="p">,</span> <span class="n">hardware_references</span><span class="p">)</span> <span class="k">for</span> <span class="n">item</span> <span class="ow">in</span> <span class="n">hardware_data</span><span class="p">]</span>
        <span class="n">hardware_map</span> <span class="o">=</span> <span class="p">{</span><span class="n">hw_data</span><span class="p">[</span><span class="s2">&quot;id&quot;</span><span class="p">]:</span> <span class="n">hw</span> <span class="k">for</span> <span class="n">hw_data</span><span class="p">,</span> <span class="n">hw</span> <span class="ow">in</span> <span class="nb">zip</span><span class="p">(</span><span class="n">hardware_data</span><span class="p">,</span> <span class="n">hardware_objects</span><span class="p">)}</span>

        <span class="k">for</span> <span class="n">hw</span> <span class="ow">in</span> <span class="n">hardware_objects</span><span class="p">:</span>
            <span class="n">instance</span><span class="o">.</span><span class="n">multi_hardware</span><span class="o">.</span><span class="n">add_hardware</span><span class="p">(</span><span class="n">hw</span><span class="p">)</span>

        <span class="c1"># Deserialize channels</span>
        <span class="k">for</span> <span class="n">channel_dict</span> <span class="ow">in</span> <span class="n">channel_data</span><span class="p">:</span>
            <span class="n">parent_info</span> <span class="o">=</span> <span class="n">channel_dict</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;parent_hardware&quot;</span><span class="p">)</span>
            <span class="k">if</span> <span class="n">parent_info</span><span class="p">:</span>
                <span class="n">parent_hw_id</span> <span class="o">=</span> <span class="n">parent_info</span><span class="p">[</span><span class="s2">&quot;id&quot;</span><span class="p">]</span>
                <span class="n">parent_hw</span> <span class="o">=</span> <span class="n">hardware_map</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">parent_hw_id</span><span class="p">)</span>
                <span class="k">if</span> <span class="n">parent_hw</span><span class="p">:</span>
                    <span class="n">handle</span> <span class="o">=</span> <span class="n">parent_hw</span><span class="o">.</span><span class="n">_handle</span>
                    <span class="n">channel</span> <span class="o">=</span> <span class="bp">cls</span><span class="o">.</span><span class="n">_create_object_with_handle</span><span class="p">(</span>
                        <span class="n">channel_dict</span><span class="p">,</span> <span class="n">hardware_references</span><span class="p">,</span> <span class="n">handle</span><span class="p">,</span> <span class="n">obj_type</span><span class="o">=</span><span class="s2">&quot;channel&quot;</span>
                    <span class="p">)</span>
                    <span class="n">parent_hw</span><span class="o">.</span><span class="n">add_channels</span><span class="p">(</span><span class="n">channel</span><span class="p">)</span>

        <span class="c1"># Deserialize modules</span>
        <span class="k">for</span> <span class="n">module_dict</span> <span class="ow">in</span> <span class="n">module_data</span><span class="p">:</span>
            <span class="n">parent_hw_info</span> <span class="o">=</span> <span class="n">module_dict</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;parent_hardware&quot;</span><span class="p">)</span>
            <span class="k">if</span> <span class="n">parent_hw_info</span><span class="p">:</span>
                <span class="n">parent_hw_id</span> <span class="o">=</span> <span class="n">parent_hw_info</span><span class="p">[</span><span class="s2">&quot;id&quot;</span><span class="p">]</span>
                <span class="n">parent_hw</span> <span class="o">=</span> <span class="n">hardware_map</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">parent_hw_id</span><span class="p">)</span>
                <span class="k">if</span> <span class="n">parent_hw</span><span class="p">:</span>
                    <span class="n">handle</span> <span class="o">=</span> <span class="n">parent_hw</span><span class="o">.</span><span class="n">_handle</span>
                    <span class="n">module</span> <span class="o">=</span> <span class="bp">cls</span><span class="o">.</span><span class="n">_create_object_with_handle</span><span class="p">(</span><span class="n">module_dict</span><span class="p">,</span> <span class="n">hardware_references</span><span class="p">,</span> <span class="n">handle</span><span class="p">,</span> <span class="n">obj_type</span><span class="o">=</span><span class="s2">&quot;module&quot;</span><span class="p">)</span>
                    <span class="n">parent_hw</span><span class="o">.</span><span class="n">add_channels</span><span class="p">(</span><span class="n">module</span><span class="p">)</span>

        <span class="k">return</span> <span class="n">instance</span></div>


    <span class="nd">@classmethod</span>
    <span class="k">def</span> <span class="nf">_create_object_with_handle</span><span class="p">(</span>
        <span class="bp">cls</span><span class="p">,</span>
        <span class="n">obj_dict</span><span class="p">:</span> <span class="n">Dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Any</span><span class="p">],</span>
        <span class="n">references</span><span class="p">:</span> <span class="n">Dict</span><span class="p">[</span><span class="nb">int</span><span class="p">,</span> <span class="n">Any</span><span class="p">],</span>
        <span class="n">handle</span><span class="p">:</span> <span class="n">Any</span><span class="p">,</span>
        <span class="n">obj_type</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span>
    <span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Helper function to create an instance of a Serializable object with a handle.</span>

<span class="sd">        :param obj_dict: The dictionary representation of the object.</span>
<span class="sd">        :type obj_dict: Dict[str, Any]</span>
<span class="sd">        :param references: A dictionary to store references to created objects.</span>
<span class="sd">        :type references: Dict[int, Any]</span>
<span class="sd">        :param handle: The handle to the object.</span>
<span class="sd">        :type handle: Any</span>
<span class="sd">        :param obj_type: The type of the object (either &quot;channel&quot; or &quot;module&quot;).</span>
<span class="sd">        :type obj_type: str</span>

<span class="sd">        :return: Instance of the object.</span>
<span class="sd">        :rtype: Any</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="n">module_name</span> <span class="o">=</span> <span class="n">obj_dict</span><span class="p">[</span><span class="s2">&quot;module&quot;</span><span class="p">]</span>
        <span class="n">class_name</span> <span class="o">=</span> <span class="n">obj_dict</span><span class="p">[</span><span class="s2">&quot;class&quot;</span><span class="p">]</span>
        <span class="n">module</span> <span class="o">=</span> <span class="n">importlib</span><span class="o">.</span><span class="n">import_module</span><span class="p">(</span><span class="n">module_name</span><span class="p">)</span>
        <span class="n">obj_cls</span> <span class="o">=</span> <span class="nb">getattr</span><span class="p">(</span><span class="n">module</span><span class="p">,</span> <span class="n">class_name</span><span class="p">)</span>

        <span class="n">instance</span> <span class="o">=</span> <span class="n">obj_cls</span><span class="o">.</span><span class="fm">__new__</span><span class="p">(</span><span class="n">obj_cls</span><span class="p">)</span>
        <span class="n">references</span><span class="p">[</span><span class="n">obj_dict</span><span class="p">[</span><span class="s2">&quot;id&quot;</span><span class="p">]]</span> <span class="o">=</span> <span class="n">instance</span>
        <span class="n">attributes</span> <span class="o">=</span> <span class="n">obj_dict</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;attributes&quot;</span><span class="p">,</span> <span class="p">{})</span>
        <span class="k">for</span> <span class="n">key</span><span class="p">,</span> <span class="n">value</span> <span class="ow">in</span> <span class="n">attributes</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
            <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">value</span><span class="p">,</span> <span class="nb">dict</span><span class="p">)</span> <span class="ow">and</span> <span class="s2">&quot;class&quot;</span> <span class="ow">in</span> <span class="n">value</span> <span class="ow">and</span> <span class="s2">&quot;module&quot;</span> <span class="ow">in</span> <span class="n">value</span><span class="p">:</span>
                <span class="k">if</span> <span class="n">obj_type</span> <span class="o">==</span> <span class="s2">&quot;module&quot;</span><span class="p">:</span>
                    <span class="nb">setattr</span><span class="p">(</span><span class="n">instance</span><span class="p">,</span> <span class="n">key</span><span class="p">,</span> <span class="n">Serializable</span><span class="o">.</span><span class="n">from_dict</span><span class="p">(</span><span class="n">value</span><span class="p">,</span> <span class="n">references</span><span class="p">))</span>
                <span class="k">else</span><span class="p">:</span>  <span class="c1"># For channels</span>
                    <span class="nb">setattr</span><span class="p">(</span>
                        <span class="n">instance</span><span class="p">,</span>
                        <span class="n">key</span><span class="p">,</span>
                        <span class="bp">cls</span><span class="o">.</span><span class="n">_create_object_with_handle</span><span class="p">(</span><span class="n">value</span><span class="p">,</span> <span class="n">references</span><span class="p">,</span> <span class="n">handle</span><span class="p">,</span> <span class="n">obj_type</span><span class="p">),</span>
                    <span class="p">)</span>
                <span class="nb">setattr</span><span class="p">(</span><span class="n">instance</span><span class="p">,</span> <span class="n">key</span><span class="p">,</span> <span class="n">Serializable</span><span class="o">.</span><span class="n">from_dict</span><span class="p">(</span><span class="n">value</span><span class="p">,</span> <span class="n">references</span><span class="p">))</span>
            <span class="k">elif</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">value</span><span class="p">,</span> <span class="nb">list</span><span class="p">):</span>
                <span class="nb">setattr</span><span class="p">(</span>
                    <span class="n">instance</span><span class="p">,</span>
                    <span class="n">key</span><span class="p">,</span>
                    <span class="p">[</span>
                        <span class="p">(</span>
                            <span class="bp">cls</span><span class="o">.</span><span class="n">_create_object_with_handle</span><span class="p">(</span><span class="n">item</span><span class="p">,</span> <span class="n">references</span><span class="p">,</span> <span class="n">handle</span><span class="p">,</span> <span class="n">obj_type</span><span class="p">)</span>
                            <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">item</span><span class="p">,</span> <span class="nb">dict</span><span class="p">)</span>
                            <span class="k">else</span> <span class="n">item</span>
                        <span class="p">)</span>
                        <span class="k">for</span> <span class="n">item</span> <span class="ow">in</span> <span class="n">value</span>
                    <span class="p">],</span>
                <span class="p">)</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="nb">setattr</span><span class="p">(</span><span class="n">instance</span><span class="p">,</span> <span class="n">key</span><span class="p">,</span> <span class="n">value</span><span class="p">)</span>

        <span class="c1"># Set handle before initializing</span>
        <span class="n">instance</span><span class="o">.</span><span class="n">_handle</span> <span class="o">=</span> <span class="n">handle</span>
        <span class="k">if</span> <span class="nb">hasattr</span><span class="p">(</span><span class="n">instance</span><span class="p">,</span> <span class="s2">&quot;initialize&quot;</span><span class="p">):</span>
            <span class="n">instance</span><span class="o">.</span><span class="n">initialize</span><span class="p">()</span>

        <span class="k">return</span> <span class="n">instance</span></div>



<div class="viewcode-block" id="MeasurementTask">
<a class="viewcode-back" href="../../reference.html#MeasurementSystem.measurement_server.MeasurementTask">[docs]</a>
<span class="k">class</span> <span class="nc">MeasurementTask</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Represents a measurement task that can be executed by the measurement system.</span>

<span class="sd">    :param channel: The channel or module to measure.</span>
<span class="sd">    :type channel: Union[InputChannel, InputModule]</span>
<span class="sd">    :param send_command_callback: A callback function to send commands to the control interface.</span>
<span class="sd">    :type send_command_callback: SendCommandCallbackType</span>

<span class="sd">    :return: A MeasurementTask instance.</span>
<span class="sd">    :rtype: MeasurementTask</span>
<span class="sd">    &quot;&quot;&quot;</span>

<div class="viewcode-block" id="MeasurementTask.SendCommandCallbackType_2">
<a class="viewcode-back" href="../../reference.html#MeasurementSystem.measurement_server.MeasurementTask.SendCommandCallbackType_2">[docs]</a>
    <span class="k">class</span> <span class="nc">SendCommandCallbackType_2</span><span class="p">(</span><span class="n">Protocol</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        A callback type for sending commands.</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="k">def</span> <span class="fm">__call__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">command</span><span class="p">:</span> <span class="n">Command</span><span class="p">,</span> <span class="n">priority</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="mi">5</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span> <span class="o">...</span></div>


    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span>
        <span class="n">channel</span><span class="p">:</span> <span class="n">Union</span><span class="p">[</span><span class="n">InputChannel</span><span class="p">,</span> <span class="n">InputModule</span><span class="p">],</span>
        <span class="n">send_command_callback</span><span class="p">:</span> <span class="n">SendCommandCallbackType_2</span><span class="p">,</span>
    <span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">channel</span> <span class="o">=</span> <span class="n">channel</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">send_command_callback</span> <span class="o">=</span> <span class="n">send_command_callback</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">_measurement_thread</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_measurement_thread_stop_event</span> <span class="o">=</span> <span class="n">threading</span><span class="o">.</span><span class="n">Event</span><span class="p">()</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">time_start</span> <span class="o">=</span> <span class="kc">None</span>

        <span class="c1"># Determine channels based on Y-axis channel</span>
        <span class="k">if</span> <span class="nb">hasattr</span><span class="p">(</span><span class="n">channel</span><span class="p">,</span> <span class="s2">&quot;config&quot;</span><span class="p">):</span>
            <span class="k">if</span> <span class="ow">not</span> <span class="nb">hasattr</span><span class="p">(</span><span class="n">channel</span><span class="o">.</span><span class="n">config</span><span class="p">,</span> <span class="s2">&quot;chart_number&quot;</span><span class="p">)</span> <span class="ow">or</span> <span class="ow">not</span> <span class="nb">hasattr</span><span class="p">(</span><span class="n">channel</span><span class="o">.</span><span class="n">config</span><span class="p">,</span> <span class="s2">&quot;sample_rate&quot;</span><span class="p">):</span>
                <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Channel </span><span class="si">{</span><span class="n">channel</span><span class="si">}</span><span class="s2"> has no attribute chart_number or sample_rate defined in config.&quot;</span><span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">chart_y_axis_channel</span> <span class="o">=</span> <span class="n">channel</span><span class="o">.</span><span class="n">config</span><span class="o">.</span><span class="n">chart_number</span>  <span class="c1"># Y-axis               e.g. 705</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">chart_control_channel</span> <span class="o">=</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">chart_y_axis_channel</span> <span class="o">//</span> <span class="mi">10</span><span class="p">)</span> <span class="o">*</span> <span class="mi">10</span>  <span class="c1"># decade below Y-axis    -&gt; 700</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">chart_x_axis_channel</span> <span class="o">=</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">chart_y_axis_channel</span> <span class="o">//</span> <span class="mi">10</span><span class="p">)</span> <span class="o">*</span> <span class="mi">10</span> <span class="o">+</span> <span class="mi">10</span>  <span class="c1"># decade above Y-axis    -&gt; 710</span>

<div class="viewcode-block" id="MeasurementTask.start">
<a class="viewcode-back" href="../../reference.html#MeasurementSystem.measurement_server.MeasurementTask.start">[docs]</a>
    <span class="k">def</span> <span class="nf">start</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Start the measurement task.</span>

<span class="sd">        This method starts a new thread that runs the measurement loop.</span>
<span class="sd">        The measurement loop clears the diagram, sets the X-axis and Y-axis limits,</span>
<span class="sd">        and then starts the measurement.</span>
<span class="sd">        The measurement loop runs indefinitely until the stop method is called.</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">_measurement_thread</span> <span class="o">=</span> <span class="n">threading</span><span class="o">.</span><span class="n">Thread</span><span class="p">(</span><span class="n">target</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">_measurement_loop</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_measurement_thread</span><span class="o">.</span><span class="n">daemon</span> <span class="o">=</span> <span class="kc">True</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">time_start</span> <span class="o">=</span> <span class="n">time</span><span class="o">.</span><span class="n">time_ns</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_measurement_thread</span><span class="o">.</span><span class="n">start</span><span class="p">()</span></div>


<div class="viewcode-block" id="MeasurementTask.stop">
<a class="viewcode-back" href="../../reference.html#MeasurementSystem.measurement_server.MeasurementTask.stop">[docs]</a>
    <span class="k">def</span> <span class="nf">stop</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Stop the measurement task.</span>

<span class="sd">        This method stops the measurement loop by setting the stop event,</span>
<span class="sd">        and then waits for the measurement thread to finish with a timeout</span>
<span class="sd">        of 10 seconds or the sample rate of the channel plus one second,</span>
<span class="sd">        whichever is smaller.</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_measurement_thread</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_measurement_thread_stop_event</span><span class="o">.</span><span class="n">set</span><span class="p">()</span>
            <span class="n">timeout</span> <span class="o">=</span> <span class="mi">10</span>
            <span class="k">if</span> <span class="nb">hasattr</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">channel</span><span class="p">,</span> <span class="s2">&quot;config&quot;</span><span class="p">):</span>
                <span class="k">if</span> <span class="nb">hasattr</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">channel</span><span class="o">.</span><span class="n">config</span><span class="p">,</span> <span class="s2">&quot;sample_rate&quot;</span><span class="p">):</span>
                    <span class="n">timeout</span> <span class="o">=</span> <span class="nb">min</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">channel</span><span class="o">.</span><span class="n">config</span><span class="o">.</span><span class="n">sample_rate</span> <span class="o">+</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">10</span><span class="p">)</span>  <span class="c1"># NOTE: ADDED TIMEOUT HERE!!!!</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_measurement_thread</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">timeout</span><span class="o">=</span><span class="n">timeout</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_measurement_thread</span> <span class="o">=</span> <span class="kc">None</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_measurement_thread_stop_event</span><span class="o">.</span><span class="n">clear</span><span class="p">()</span></div>


    <span class="k">def</span> <span class="nf">_measurement_loop</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Measurement loop.</span>

<span class="sd">        This method runs indefinitely until the stop method is called.</span>
<span class="sd">        The method performs a measurement task and send the result to the server.</span>

<span class="sd">        :return: None</span>
<span class="sd">        :rtype: None</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="c1"># Clear diagram, e.g. 700 Control Channel</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">send_command_callback</span><span class="p">(</span><span class="n">Command</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">chart_control_channel</span><span class="p">,</span> <span class="n">Command</span><span class="o">.</span><span class="n">Type</span><span class="o">.</span><span class="n">STRING</span><span class="p">,</span> <span class="s2">&quot;Clear&quot;</span><span class="p">))</span>

        <span class="c1"># # X-Axis</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">send_command_callback</span><span class="p">(</span><span class="n">Command</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">chart_control_channel</span><span class="p">,</span> <span class="n">Command</span><span class="o">.</span><span class="n">Type</span><span class="o">.</span><span class="n">FLOAT</span><span class="p">,</span> <span class="mi">0</span><span class="p">))</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">send_command_callback</span><span class="p">(</span><span class="n">Command</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">chart_control_channel</span><span class="p">,</span> <span class="n">Command</span><span class="o">.</span><span class="n">Type</span><span class="o">.</span><span class="n">STRING</span><span class="p">,</span> <span class="s2">&quot;Xmin&quot;</span><span class="p">))</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">send_command_callback</span><span class="p">(</span><span class="n">Command</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">chart_control_channel</span><span class="p">,</span> <span class="n">Command</span><span class="o">.</span><span class="n">Type</span><span class="o">.</span><span class="n">FLOAT</span><span class="p">,</span> <span class="mi">11</span><span class="p">))</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">send_command_callback</span><span class="p">(</span><span class="n">Command</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">chart_control_channel</span><span class="p">,</span> <span class="n">Command</span><span class="o">.</span><span class="n">Type</span><span class="o">.</span><span class="n">STRING</span><span class="p">,</span> <span class="s2">&quot;Xmax&quot;</span><span class="p">))</span>

        <span class="c1"># # Y-Axis</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">send_command_callback</span><span class="p">(</span><span class="n">Command</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">chart_control_channel</span><span class="p">,</span> <span class="n">Command</span><span class="o">.</span><span class="n">Type</span><span class="o">.</span><span class="n">FLOAT</span><span class="p">,</span> <span class="mi">0</span><span class="p">))</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">send_command_callback</span><span class="p">(</span><span class="n">Command</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">chart_control_channel</span><span class="p">,</span> <span class="n">Command</span><span class="o">.</span><span class="n">Type</span><span class="o">.</span><span class="n">STRING</span><span class="p">,</span> <span class="s2">&quot;Ymin&quot;</span><span class="p">))</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">send_command_callback</span><span class="p">(</span><span class="n">Command</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">chart_control_channel</span><span class="p">,</span> <span class="n">Command</span><span class="o">.</span><span class="n">Type</span><span class="o">.</span><span class="n">FLOAT</span><span class="p">,</span> <span class="mi">10</span><span class="p">))</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">send_command_callback</span><span class="p">(</span><span class="n">Command</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">chart_control_channel</span><span class="p">,</span> <span class="n">Command</span><span class="o">.</span><span class="n">Type</span><span class="o">.</span><span class="n">STRING</span><span class="p">,</span> <span class="s2">&quot;Ymax&quot;</span><span class="p">))</span>

        <span class="n">y_storage</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="n">y_min</span> <span class="o">=</span> <span class="mi">0</span>
        <span class="n">y_max</span> <span class="o">=</span> <span class="mi">0</span>

        <span class="n">idx</span> <span class="o">=</span> <span class="mi">0</span>
        <span class="k">while</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">_measurement_thread_stop_event</span><span class="o">.</span><span class="n">is_set</span><span class="p">():</span>
            <span class="n">idx</span> <span class="o">+=</span> <span class="mi">1</span>

            <span class="k">try</span><span class="p">:</span>
                <span class="n">data</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">channel</span><span class="o">.</span><span class="n">read</span><span class="p">()</span>
                <span class="k">if</span> <span class="n">data</span><span class="o">.</span><span class="n">get_count</span><span class="p">()</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
                    <span class="n">value</span><span class="p">,</span> <span class="n">t_value</span> <span class="o">=</span> <span class="n">data</span><span class="o">.</span><span class="n">get_last</span><span class="p">()</span>  <span class="c1"># TODO: handle list data</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;INFO: &#39;empty data&#39; should never happen --&gt; to be debugged!&quot;</span><span class="p">)</span>
                    <span class="k">continue</span>

                <span class="n">y_storage</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">value</span><span class="p">)</span>

                <span class="n">rel_time</span> <span class="o">=</span> <span class="p">(</span><span class="n">t_value</span> <span class="o">-</span> <span class="bp">self</span><span class="o">.</span><span class="n">time_start</span><span class="p">)</span> <span class="o">*</span> <span class="mi">10</span><span class="o">**-</span><span class="mi">9</span>  <span class="c1"># convert to seconds</span>

                <span class="bp">self</span><span class="o">.</span><span class="n">send_command_callback</span><span class="p">(</span><span class="n">Command</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">chart_y_axis_channel</span><span class="p">,</span> <span class="n">Command</span><span class="o">.</span><span class="n">Type</span><span class="o">.</span><span class="n">FLOAT</span><span class="p">,</span> <span class="n">value</span><span class="p">))</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">send_command_callback</span><span class="p">(</span><span class="n">Command</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">chart_x_axis_channel</span><span class="p">,</span> <span class="n">Command</span><span class="o">.</span><span class="n">Type</span><span class="o">.</span><span class="n">FLOAT</span><span class="p">,</span> <span class="n">rel_time</span><span class="p">))</span>

                <span class="c1"># TODO: dynamic update of X-Axis &amp; Y-Axis limits dependent on values</span>

                <span class="c1"># dynamic update of X-Axis</span>
                <span class="k">if</span> <span class="n">idx</span> <span class="o">&gt;</span> <span class="mi">1</span> <span class="ow">and</span> <span class="n">idx</span> <span class="o">%</span> <span class="mi">10</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">send_command_callback</span><span class="p">(</span>
                        <span class="n">Command</span><span class="p">(</span>
                            <span class="bp">self</span><span class="o">.</span><span class="n">chart_control_channel</span><span class="p">,</span>
                            <span class="n">Command</span><span class="o">.</span><span class="n">Type</span><span class="o">.</span><span class="n">FLOAT</span><span class="p">,</span>
                            <span class="n">rel_time</span> <span class="o">+</span> <span class="mi">10</span><span class="p">,</span>
                        <span class="p">)</span>
                    <span class="p">)</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">send_command_callback</span><span class="p">(</span><span class="n">Command</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">chart_control_channel</span><span class="p">,</span> <span class="n">Command</span><span class="o">.</span><span class="n">Type</span><span class="o">.</span><span class="n">STRING</span><span class="p">,</span> <span class="s2">&quot;Xmax&quot;</span><span class="p">))</span>

                <span class="c1"># dynamic update of Y-Axis</span>
                <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">y_storage</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">1</span><span class="p">:</span>
                    <span class="n">y_adder</span> <span class="o">=</span> <span class="p">(</span><span class="nb">max</span><span class="p">(</span><span class="n">y_storage</span><span class="p">)</span> <span class="o">-</span> <span class="nb">min</span><span class="p">(</span><span class="n">y_storage</span><span class="p">))</span> <span class="o">*</span> <span class="mf">0.2</span>  <span class="c1"># add 20% to the y-axis range</span>
                    <span class="n">y_min_new</span> <span class="o">=</span> <span class="nb">min</span><span class="p">(</span><span class="n">y_storage</span><span class="p">)</span> <span class="o">-</span> <span class="n">y_adder</span>
                    <span class="n">y_max_new</span> <span class="o">=</span> <span class="nb">max</span><span class="p">(</span><span class="n">y_storage</span><span class="p">)</span> <span class="o">+</span> <span class="n">y_adder</span>

                    <span class="k">if</span> <span class="p">(</span>
                        <span class="n">y_min_new</span> <span class="o">!=</span> <span class="n">y_min</span> <span class="ow">or</span> <span class="n">y_max_new</span> <span class="o">!=</span> <span class="n">y_max</span>
                    <span class="p">):</span>  <span class="c1"># IMPORTANT TODO: this will overwrite min/max from other channels if same chart is used!!!!</span>
                        <span class="n">y_min</span> <span class="o">=</span> <span class="n">y_min_new</span>
                        <span class="n">y_max</span> <span class="o">=</span> <span class="n">y_max_new</span>

                        <span class="bp">self</span><span class="o">.</span><span class="n">send_command_callback</span><span class="p">(</span><span class="n">Command</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">chart_control_channel</span><span class="p">,</span> <span class="n">Command</span><span class="o">.</span><span class="n">Type</span><span class="o">.</span><span class="n">FLOAT</span><span class="p">,</span> <span class="n">y_min</span><span class="p">))</span>
                        <span class="bp">self</span><span class="o">.</span><span class="n">send_command_callback</span><span class="p">(</span><span class="n">Command</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">chart_control_channel</span><span class="p">,</span> <span class="n">Command</span><span class="o">.</span><span class="n">Type</span><span class="o">.</span><span class="n">STRING</span><span class="p">,</span> <span class="s2">&quot;Ymin&quot;</span><span class="p">))</span>
                        <span class="bp">self</span><span class="o">.</span><span class="n">send_command_callback</span><span class="p">(</span><span class="n">Command</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">chart_control_channel</span><span class="p">,</span> <span class="n">Command</span><span class="o">.</span><span class="n">Type</span><span class="o">.</span><span class="n">FLOAT</span><span class="p">,</span> <span class="n">y_max</span><span class="p">))</span>
                        <span class="bp">self</span><span class="o">.</span><span class="n">send_command_callback</span><span class="p">(</span><span class="n">Command</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">chart_control_channel</span><span class="p">,</span> <span class="n">Command</span><span class="o">.</span><span class="n">Type</span><span class="o">.</span><span class="n">STRING</span><span class="p">,</span> <span class="s2">&quot;Ymax&quot;</span><span class="p">))</span>

                <span class="c1"># Wait time</span>
                <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">channel</span><span class="o">.</span><span class="n">config</span><span class="o">.</span><span class="n">sample_rate</span> <span class="o">&lt;=</span> <span class="mi">0</span><span class="p">:</span>
                    <span class="k">pass</span>  <span class="c1"># NOTE: no sleep --&gt; full speed (NOT RECOMMENDED!!!)</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="n">time</span><span class="o">.</span><span class="n">sleep</span><span class="p">(</span><span class="mi">1</span> <span class="o">/</span> <span class="bp">self</span><span class="o">.</span><span class="n">channel</span><span class="o">.</span><span class="n">config</span><span class="o">.</span><span class="n">sample_rate</span><span class="p">)</span>

            <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
                <span class="c1"># break  # stop measurement loop</span>
                <span class="k">raise</span> <span class="ne">Exception</span><span class="p">(</span><span class="s2">&quot;&gt;&gt;&gt; STOPPED MEASUREMENT TASK:&quot;</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">channel</span><span class="o">.</span><span class="n">name</span><span class="p">,</span> <span class="s2">&quot;Exception:&quot;</span><span class="p">,</span> <span class="n">e</span><span class="p">)</span></div>



<div class="viewcode-block" id="MeasurementTaskManager">
<a class="viewcode-back" href="../../reference.html#MeasurementSystem.measurement_server.MeasurementTaskManager">[docs]</a>
<span class="k">class</span> <span class="nc">MeasurementTaskManager</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Manages a collection of measurement tasks and provides functionality to start and stop them all.</span>

<span class="sd">    :param measurement_system: An instance of MeasurementSystem class.</span>
<span class="sd">    :type measurement_system: MeasurementSystem</span>

<span class="sd">    :return: MeasurementTaskManager instance</span>
<span class="sd">    :rtype: MeasurementTaskManager</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">measurement_system</span><span class="p">:</span> <span class="n">MeasurementSystem</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">measurement_system</span> <span class="o">=</span> <span class="n">measurement_system</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">send_command_callback</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">measurement_system</span><span class="o">.</span><span class="n">add_command_to_send_queue</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">tasks</span> <span class="o">=</span> <span class="p">[]</span>

<div class="viewcode-block" id="MeasurementTaskManager.initialize_tasks">
<a class="viewcode-back" href="../../reference.html#MeasurementSystem.measurement_server.MeasurementTaskManager.initialize_tasks">[docs]</a>
    <span class="k">def</span> <span class="nf">initialize_tasks</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Initialize all measurement tasks.</span>

<span class="sd">        This method iterates over all channels in the hardware interface and</span>
<span class="sd">        creates a MeasurementTask instance for each enabled input channel. The</span>
<span class="sd">        created tasks are stored in the tasks list.</span>

<span class="sd">        :return: None</span>
<span class="sd">        :rtype: None</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">tasks</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="k">for</span> <span class="n">channel</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">measurement_system</span><span class="o">.</span><span class="n">hardware_interface</span><span class="o">.</span><span class="n">multi_hardware</span><span class="o">.</span><span class="n">get_channels</span><span class="p">():</span>
            <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">channel</span><span class="p">,</span> <span class="p">(</span><span class="n">InputChannel</span><span class="p">,</span> <span class="n">InputModule</span><span class="p">)):</span>
                <span class="k">if</span> <span class="nb">hasattr</span><span class="p">(</span><span class="n">channel</span><span class="p">,</span> <span class="s2">&quot;config&quot;</span><span class="p">):</span>
                    <span class="k">if</span> <span class="ow">not</span> <span class="nb">hasattr</span><span class="p">(</span><span class="n">channel</span><span class="o">.</span><span class="n">config</span><span class="p">,</span> <span class="s2">&quot;enabled&quot;</span><span class="p">):</span>
                        <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Channel </span><span class="si">{</span><span class="n">channel</span><span class="si">}</span><span class="s2"> has no attribute &#39;config.enabled&#39; defined&quot;</span><span class="p">)</span>

                <span class="k">if</span> <span class="n">channel</span><span class="o">.</span><span class="n">config</span><span class="o">.</span><span class="n">enabled</span><span class="p">:</span>
                    <span class="n">task</span> <span class="o">=</span> <span class="n">MeasurementTask</span><span class="p">(</span><span class="n">channel</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">send_command_callback</span><span class="p">)</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">tasks</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">task</span><span class="p">)</span></div>


<div class="viewcode-block" id="MeasurementTaskManager.start_tasks">
<a class="viewcode-back" href="../../reference.html#MeasurementSystem.measurement_server.MeasurementTaskManager.start_tasks">[docs]</a>
    <span class="k">def</span> <span class="nf">start_tasks</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Start all measurement tasks.</span>

<span class="sd">        This method iterates over all measurement tasks in the tasks list and</span>
<span class="sd">        calls their start method.</span>

<span class="sd">        :return: None</span>
<span class="sd">        :rtype: None</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="k">for</span> <span class="n">task</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">tasks</span><span class="p">:</span>
            <span class="k">assert</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">task</span><span class="p">,</span> <span class="n">MeasurementTask</span><span class="p">)</span>
            <span class="n">task</span><span class="o">.</span><span class="n">start</span><span class="p">()</span></div>


<div class="viewcode-block" id="MeasurementTaskManager.stop_tasks">
<a class="viewcode-back" href="../../reference.html#MeasurementSystem.measurement_server.MeasurementTaskManager.stop_tasks">[docs]</a>
    <span class="k">def</span> <span class="nf">stop_tasks</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Stop all measurement tasks.</span>

<span class="sd">        This method iterates over all measurement tasks in the tasks list and</span>
<span class="sd">        calls their stop method in parallel using a ThreadPoolExecutor. This</span>
<span class="sd">        allows for faster stopping of all measurement tasks.</span>

<span class="sd">        :return: None</span>
<span class="sd">        :rtype: None</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="c1"># Serial execution of task.stop() --&gt; very slow, dependent on channel.config.sample_rate</span>
        <span class="c1"># for task in self.tasks:</span>
        <span class="c1">#     assert isinstance(task, MeasurementTask)</span>
        <span class="c1">#     task.stop()</span>

        <span class="c1"># Parllel execution of task.stop()</span>

        <span class="k">with</span> <span class="n">ThreadPoolExecutor</span><span class="p">()</span> <span class="k">as</span> <span class="n">executor</span><span class="p">:</span>
            <span class="n">futures</span> <span class="o">=</span> <span class="p">[</span><span class="n">executor</span><span class="o">.</span><span class="n">submit</span><span class="p">(</span><span class="n">task</span><span class="o">.</span><span class="n">stop</span><span class="p">)</span> <span class="k">for</span> <span class="n">task</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">tasks</span><span class="p">]</span>
            <span class="k">for</span> <span class="n">future</span> <span class="ow">in</span> <span class="n">as_completed</span><span class="p">(</span><span class="n">futures</span><span class="p">):</span>
                <span class="k">try</span><span class="p">:</span>
                    <span class="n">future</span><span class="o">.</span><span class="n">result</span><span class="p">(</span><span class="n">timeout</span><span class="o">=</span><span class="mi">10</span><span class="p">)</span>
                <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
                    <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;&gt;&gt; An error occurred while stopping a task: </span><span class="si">{</span><span class="n">e</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span></div>
</div>



<div class="viewcode-block" id="ControlTask">
<a class="viewcode-back" href="../../reference.html#MeasurementSystem.measurement_server.ControlTask">[docs]</a>
<span class="k">class</span> <span class="nc">ControlTask</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Represents a control task that can be executed by the system to perform a specific control action.</span>

<span class="sd">    :param measurement_system: An instance of MeasurementSystem class.</span>
<span class="sd">    :type measurement_system: MeasurementSystem</span>
<span class="sd">    :param send_command_callback: A callback function that is called when a command is sent to the measurement system.</span>
<span class="sd">    :type send_command_callback: SendCommandCallbackType</span>

<span class="sd">    :return: ControlTask instance</span>
<span class="sd">    :rtype: ControlTask</span>
<span class="sd">    &quot;&quot;&quot;</span>

<div class="viewcode-block" id="ControlTask.SendCommandCallbackType">
<a class="viewcode-back" href="../../reference.html#MeasurementSystem.measurement_server.ControlTask.SendCommandCallbackType">[docs]</a>
    <span class="k">class</span> <span class="nc">SendCommandCallbackType</span><span class="p">(</span><span class="n">Protocol</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        A callback type for sending commands.</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="k">def</span> <span class="fm">__call__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">command</span><span class="p">:</span> <span class="n">Command</span><span class="p">,</span> <span class="n">priority</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="mi">5</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span> <span class="o">...</span></div>


    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span>
        <span class="n">measurement_system</span><span class="p">:</span> <span class="n">MeasurementSystem</span><span class="p">,</span>
        <span class="n">send_command_callback</span><span class="p">:</span> <span class="n">SendCommandCallbackType</span><span class="p">,</span>
    <span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">measurement_system</span> <span class="o">=</span> <span class="n">measurement_system</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">send_command_callback</span> <span class="o">=</span> <span class="n">send_command_callback</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">_control_thread</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_control_thread_stop_event</span> <span class="o">=</span> <span class="n">threading</span><span class="o">.</span><span class="n">Event</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_lock</span> <span class="o">=</span> <span class="n">threading</span><span class="o">.</span><span class="n">Lock</span><span class="p">()</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">_command_queue</span> <span class="o">=</span> <span class="n">OrderedPriorityQueue</span><span class="p">(</span><span class="n">name</span><span class="o">=</span><span class="s2">&quot;CommandQueue&quot;</span><span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">_command_storage</span> <span class="o">=</span> <span class="kc">None</span>

<div class="viewcode-block" id="ControlTask.start">
<a class="viewcode-back" href="../../reference.html#MeasurementSystem.measurement_server.ControlTask.start">[docs]</a>
    <span class="k">def</span> <span class="nf">start</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Starts the control loop.</span>

<span class="sd">        This method starts the control loop in a separate thread. The thread</span>
<span class="sd">        will continue to run until the stop method is called.</span>

<span class="sd">        :return: None</span>
<span class="sd">        :rtype: None</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">_control_thread</span> <span class="o">=</span> <span class="n">threading</span><span class="o">.</span><span class="n">Thread</span><span class="p">(</span><span class="n">target</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">_control_loop</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_control_thread</span><span class="o">.</span><span class="n">daemon</span> <span class="o">=</span> <span class="kc">True</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_control_thread</span><span class="o">.</span><span class="n">start</span><span class="p">()</span></div>


<div class="viewcode-block" id="ControlTask.stop">
<a class="viewcode-back" href="../../reference.html#MeasurementSystem.measurement_server.ControlTask.stop">[docs]</a>
    <span class="k">def</span> <span class="nf">stop</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Stops the control loop.</span>

<span class="sd">        This method stops the control loop thread and waits for the thread to finish.</span>
<span class="sd">        If the control loop is not running, this method does nothing.</span>

<span class="sd">        :return: None</span>
<span class="sd">        :rtype: None</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_control_thread</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_control_thread_stop_event</span><span class="o">.</span><span class="n">set</span><span class="p">()</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_control_thread</span><span class="o">.</span><span class="n">join</span><span class="p">()</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_control_thread</span> <span class="o">=</span> <span class="kc">None</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_control_thread_stop_event</span><span class="o">.</span><span class="n">clear</span><span class="p">()</span></div>


<div class="viewcode-block" id="ControlTask.add_command">
<a class="viewcode-back" href="../../reference.html#MeasurementSystem.measurement_server.ControlTask.add_command">[docs]</a>
    <span class="k">def</span> <span class="nf">add_command</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">command</span><span class="p">:</span> <span class="n">Command</span><span class="p">,</span> <span class="n">priority</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="mi">5</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Adds a command to the control loop queue.</span>

<span class="sd">        This method adds a command to the control loop queue with a given priority.</span>
<span class="sd">        The control loop will execute the command in the order of priority.</span>

<span class="sd">        :param command: The command to add to the queue.</span>
<span class="sd">        :type command: Command</span>
<span class="sd">        :param priority: The priority of the command. Higher priority commands are executed first.</span>
<span class="sd">        :type priority: int</span>
<span class="sd">        :return: None</span>
<span class="sd">        :rtype: None</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">_command_queue</span><span class="o">.</span><span class="n">put</span><span class="p">(</span><span class="n">command</span><span class="p">,</span> <span class="n">priority</span><span class="p">)</span></div>


    <span class="k">def</span> <span class="nf">_control_loop</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Control loop thread.</span>

<span class="sd">        This method runs in a separate thread and executes the commands in the command queue.</span>
<span class="sd">        The commands are executed in the order of priority. If the command queue is empty, the</span>
<span class="sd">        thread waits for a command to be added to the queue.</span>

<span class="sd">        :return: None</span>
<span class="sd">        :rtype: None</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="k">while</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">_control_thread_stop_event</span><span class="o">.</span><span class="n">is_set</span><span class="p">():</span>
            <span class="k">try</span><span class="p">:</span>
                <span class="n">command</span><span class="p">,</span> <span class="n">priority</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_command_queue</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">timeout</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>  <span class="c1"># Wait for a command</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">send_command_callback</span><span class="p">(</span><span class="n">command</span><span class="p">,</span> <span class="n">priority</span><span class="p">)</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">_execute_command</span><span class="p">(</span><span class="n">command</span><span class="p">)</span>

            <span class="k">except</span> <span class="n">queue</span><span class="o">.</span><span class="n">Empty</span><span class="p">:</span>
                <span class="k">continue</span>

    <span class="k">def</span> <span class="nf">_execute_command</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">command</span><span class="p">:</span> <span class="n">Command</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Executes a control command.</span>

<span class="sd">        This method executes a control command. The command is executed immediately.</span>

<span class="sd">        :param command: The command to execute.</span>
<span class="sd">        :type command: Command</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="c1"># Helper functions</span>
        <span class="k">def</span> <span class="nf">_calculate_name</span><span class="p">(</span><span class="n">diagram_channel</span><span class="p">,</span> <span class="n">selected_index</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">str</span><span class="p">:</span>
<span class="w">            </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">            Helper function to calculate the name of a chart control channel based on the selected diagram channel and index.</span>

<span class="sd">            The channel number of the chart control channel is calculated as follows:</span>
<span class="sd">            base_name_number + (diagram_index * names_per_diagram) + (selected_index - 1)</span>
<span class="sd">            where:</span>
<span class="sd">            - base_name_number is 701</span>
<span class="sd">            - diagram_index is the index of the selected diagram (0-4)</span>
<span class="sd">            - names_per_diagram is 20</span>
<span class="sd">            - selected_index is the index of the selected channel in the diagram (1-20)</span>

<span class="sd">            :param diagram_channel: The channel number of the selected diagram (801-805).</span>
<span class="sd">            :type diagram_channel: int</span>
<span class="sd">            :param selected_index: The index of the selected channel in the diagram (1-20).</span>
<span class="sd">            :type selected_index: int</span>

<span class="sd">            :return: The name of the chart control channel.</span>
<span class="sd">            :rtype: str</span>
<span class="sd">            &quot;&quot;&quot;</span>

            <span class="n">diagram_channel</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">diagram_channel</span><span class="p">)</span>
            <span class="n">selected_index</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">selected_index</span><span class="p">)</span>
            <span class="c1"># TODO: error handling</span>
            <span class="c1">#   - selected_index &gt; 0 --&gt; error</span>
            <span class="c1">#   - diagram_channel != 801-805 --&gt; error</span>

            <span class="n">base_name_number</span> <span class="o">=</span> <span class="mi">701</span>
            <span class="n">names_per_diagram</span> <span class="o">=</span> <span class="mi">20</span>

            <span class="n">diagram_index</span> <span class="o">=</span> <span class="n">diagram_channel</span> <span class="o">-</span> <span class="mi">801</span>
            <span class="n">base_for_diagram</span> <span class="o">=</span> <span class="n">base_name_number</span> <span class="o">+</span> <span class="p">(</span><span class="n">diagram_index</span> <span class="o">*</span> <span class="n">names_per_diagram</span><span class="p">)</span>  <span class="c1"># 701-719, 720-739, ...</span>
            <span class="k">return</span> <span class="nb">int</span><span class="p">(</span><span class="n">base_for_diagram</span> <span class="o">+</span> <span class="p">(</span><span class="n">selected_index</span> <span class="o">-</span> <span class="mi">1</span><span class="p">))</span>

        <span class="k">def</span> <span class="nf">_reset_channel_selection</span><span class="p">(</span><span class="bp">self</span><span class="p">:</span> <span class="n">ControlTask</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
<span class="w">            </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">            Helper function to reset the channel selection in the control interface.</span>

<span class="sd">            This method resets the channel selection in the control interface by sending commands to the server.</span>
<span class="sd">            The commands are sent with priority 0.</span>

<span class="sd">            :param self: The instance of the control task.</span>
<span class="sd">            :type self: ControlTask</span>

<span class="sd">            :return: None</span>
<span class="sd">            :rtype: None</span>
<span class="sd">            &quot;&quot;&quot;</span>

            <span class="k">for</span> <span class="n">channel</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">801</span><span class="p">,</span> <span class="mi">805</span> <span class="o">+</span> <span class="mi">1</span><span class="p">):</span>
                <span class="n">channel</span> <span class="o">=</span> <span class="n">channel</span> <span class="o">+</span> <span class="mi">10</span>  <span class="c1"># according contol channel (811 - 815)</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">send_command_callback</span><span class="p">(</span><span class="n">Command</span><span class="p">(</span><span class="n">channel</span><span class="p">,</span> <span class="n">Command</span><span class="o">.</span><span class="n">Type</span><span class="o">.</span><span class="n">F</span><span class="p">,</span> <span class="mi">0</span><span class="p">))</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">send_command_callback</span><span class="p">(</span><span class="n">Command</span><span class="p">(</span><span class="mi">820</span><span class="p">,</span> <span class="n">Command</span><span class="o">.</span><span class="n">Type</span><span class="o">.</span><span class="n">S</span><span class="p">,</span> <span class="s2">&quot;Kein Kanal ausgewhlt!&quot;</span><span class="p">))</span>

        <span class="c1"># Control Commands Execution</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="c1"># Channel selection for chart control</span>
            <span class="k">if</span> <span class="mi">801</span> <span class="o">&lt;=</span> <span class="n">command</span><span class="o">.</span><span class="n">channel</span> <span class="o">&lt;=</span> <span class="mi">805</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">_command_storage</span> <span class="o">=</span> <span class="n">command</span>
                <span class="n">msg</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot;Received control command with channel number = </span><span class="si">{</span><span class="n">command</span><span class="o">.</span><span class="n">value</span><span class="si">}</span><span class="s2">, waiting for next control command + value&quot;</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">measurement_system</span><span class="o">.</span><span class="n">printConsole</span><span class="p">(</span><span class="n">msg</span><span class="p">)</span>
                <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;&gt;&gt;&quot;</span><span class="p">,</span> <span class="n">msg</span><span class="p">)</span>

                <span class="c1"># Return: send all other channels for chart control to 0</span>
                <span class="k">for</span> <span class="n">channel</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">801</span><span class="p">,</span> <span class="mi">805</span> <span class="o">+</span> <span class="mi">1</span><span class="p">):</span>
                    <span class="k">if</span> <span class="n">channel</span> <span class="o">!=</span> <span class="n">command</span><span class="o">.</span><span class="n">channel</span><span class="p">:</span>
                        <span class="n">channel</span> <span class="o">=</span> <span class="n">channel</span> <span class="o">+</span> <span class="mi">10</span>  <span class="c1"># according contol channel (811 - 815)</span>
                        <span class="bp">self</span><span class="o">.</span><span class="n">send_command_callback</span><span class="p">(</span><span class="n">Command</span><span class="p">(</span><span class="n">channel</span><span class="p">,</span> <span class="n">Command</span><span class="o">.</span><span class="n">Type</span><span class="o">.</span><span class="n">F</span><span class="p">,</span> <span class="s2">&quot;0&quot;</span><span class="p">))</span>

                <span class="c1"># Kanal Anzeige</span>
                <span class="k">if</span> <span class="n">command</span><span class="o">.</span><span class="n">value</span> <span class="o">!=</span> <span class="mi">0</span><span class="p">:</span>
                    <span class="n">channel_name</span> <span class="o">=</span> <span class="n">_calculate_name</span><span class="p">(</span><span class="n">command</span><span class="o">.</span><span class="n">channel</span><span class="p">,</span> <span class="n">command</span><span class="o">.</span><span class="n">value</span><span class="p">)</span>
                    <span class="n">cmd</span> <span class="o">=</span> <span class="n">Command</span><span class="p">(</span><span class="mi">820</span><span class="p">,</span> <span class="n">Command</span><span class="o">.</span><span class="n">Type</span><span class="o">.</span><span class="n">S</span><span class="p">,</span> <span class="sa">f</span><span class="s2">&quot;Kanal </span><span class="si">{</span><span class="n">channel_name</span><span class="si">}</span><span class="s2"> ausgewhlt!&quot;</span><span class="p">)</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="n">cmd</span> <span class="o">=</span> <span class="n">Command</span><span class="p">(</span><span class="mi">820</span><span class="p">,</span> <span class="n">Command</span><span class="o">.</span><span class="n">Type</span><span class="o">.</span><span class="n">S</span><span class="p">,</span> <span class="s2">&quot;Kein Kanal ausgewhlt!&quot;</span><span class="p">)</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">send_command_callback</span><span class="p">(</span><span class="n">cmd</span><span class="p">)</span>

                <span class="c1"># Find channel</span>
                <span class="n">channels</span> <span class="o">=</span> <span class="p">[]</span>
                <span class="k">for</span> <span class="n">channel</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">measurement_system</span><span class="o">.</span><span class="n">hardware_interface</span><span class="o">.</span><span class="n">multi_hardware</span><span class="o">.</span><span class="n">get_channels</span><span class="p">():</span>
                    <span class="c1"># check if channel has config attribute</span>
                    <span class="k">if</span> <span class="nb">hasattr</span><span class="p">(</span><span class="n">channel</span><span class="p">,</span> <span class="s2">&quot;config&quot;</span><span class="p">):</span>
                        <span class="k">if</span> <span class="nb">hasattr</span><span class="p">(</span><span class="n">channel</span><span class="o">.</span><span class="n">config</span><span class="p">,</span> <span class="s2">&quot;chart_number&quot;</span><span class="p">):</span>
                            <span class="k">if</span> <span class="n">channel</span><span class="o">.</span><span class="n">config</span><span class="o">.</span><span class="n">chart_number</span> <span class="o">==</span> <span class="n">channel_name</span><span class="p">:</span>
                                <span class="n">channels</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">channel</span><span class="p">)</span>
                <span class="c1"># channels = [ch for ch in self.measurement_system.hardware_interface.multi_hardware.get_channels() if ch.config.chart_number == channel_name]</span>

                <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">channels</span><span class="p">)</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
                    <span class="n">cmd</span> <span class="o">=</span> <span class="n">Command</span><span class="p">(</span><span class="mi">829</span><span class="p">,</span> <span class="n">Command</span><span class="o">.</span><span class="n">Type</span><span class="o">.</span><span class="n">F</span><span class="p">,</span> <span class="mi">0</span><span class="p">)</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">send_command_callback</span><span class="p">(</span><span class="n">cmd</span><span class="p">)</span>

                    <span class="c1"># cmd = Command(821, Command.Type.S, f&quot;Offset: not found!&quot;)</span>
                    <span class="c1"># self.send_command_callback(cmd)</span>

                    <span class="c1"># cmd = Command(822, Command.Type.S, f&quot;Gain: not found!&quot;)</span>
                    <span class="c1"># self.send_command_callback(cmd)</span>

                    <span class="n">cmd</span> <span class="o">=</span> <span class="n">Command</span><span class="p">(</span><span class="mi">823</span><span class="p">,</span> <span class="n">Command</span><span class="o">.</span><span class="n">Type</span><span class="o">.</span><span class="n">S</span><span class="p">,</span> <span class="s2">&quot;SR: not found!&quot;</span><span class="p">)</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">send_command_callback</span><span class="p">(</span><span class="n">cmd</span><span class="p">)</span>

                <span class="k">elif</span> <span class="nb">len</span><span class="p">(</span><span class="n">channels</span><span class="p">)</span> <span class="o">==</span> <span class="mi">1</span><span class="p">:</span>
                    <span class="n">channel</span> <span class="o">=</span> <span class="n">channels</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>

                    <span class="c1"># Enable Anzeige</span>
                    <span class="n">enable</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">channel</span><span class="o">.</span><span class="n">config</span><span class="o">.</span><span class="n">enabled</span><span class="p">)</span> <span class="o">+</span> <span class="mi">1</span>
                    <span class="n">cmd</span> <span class="o">=</span> <span class="n">Command</span><span class="p">(</span><span class="mi">829</span><span class="p">,</span> <span class="n">Command</span><span class="o">.</span><span class="n">Type</span><span class="o">.</span><span class="n">F</span><span class="p">,</span> <span class="n">enable</span><span class="p">)</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">send_command_callback</span><span class="p">(</span><span class="n">cmd</span><span class="p">)</span>

                    <span class="c1"># Model Anzeige</span>
                    <span class="n">cmd</span> <span class="o">=</span> <span class="n">Command</span><span class="p">(</span><span class="mi">821</span><span class="p">,</span> <span class="n">Command</span><span class="o">.</span><span class="n">Type</span><span class="o">.</span><span class="n">S</span><span class="p">,</span> <span class="n">channel</span><span class="o">.</span><span class="n">model</span><span class="o">.</span><span class="n">to_string</span><span class="p">())</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">send_command_callback</span><span class="p">(</span><span class="n">cmd</span><span class="p">)</span>

                    <span class="c1"># # Offset Anzeige</span>
                    <span class="c1"># cmd = Command(821, Command.Type.S, f&quot;Offset: {channel.offset}&quot;)</span>
                    <span class="c1"># self.send_command_callback(cmd)</span>

                    <span class="c1"># # Gain Anzeige</span>
                    <span class="c1"># cmd = Command(822, Command.Type.S, f&quot;Gain: {channel.gain}&quot;)</span>
                    <span class="c1"># self.send_command_callback(cmd)</span>

                    <span class="c1"># Sample Rate Anzeige</span>
                    <span class="n">cmd</span> <span class="o">=</span> <span class="n">Command</span><span class="p">(</span><span class="mi">823</span><span class="p">,</span> <span class="n">Command</span><span class="o">.</span><span class="n">Type</span><span class="o">.</span><span class="n">S</span><span class="p">,</span> <span class="sa">f</span><span class="s2">&quot;SR: </span><span class="si">{</span><span class="n">channel</span><span class="o">.</span><span class="n">config</span><span class="o">.</span><span class="n">sample_rate</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">send_command_callback</span><span class="p">(</span><span class="n">cmd</span><span class="p">)</span>

                <span class="k">else</span><span class="p">:</span>
                    <span class="k">raise</span> <span class="ne">Exception</span><span class="p">(</span><span class="s2">&quot;Multiple channels with same chart number found!!!&quot;</span><span class="p">)</span>  <span class="c1"># TODO: error handling</span>

            <span class="c1"># Channel Enable</span>
            <span class="k">elif</span> <span class="n">command</span><span class="o">.</span><span class="n">channel</span> <span class="o">==</span> <span class="mi">830</span><span class="p">:</span>
                <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_command_storage</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
                    <span class="n">msg</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot;Received control command for channel enable: value = </span><span class="si">{</span><span class="n">command</span><span class="o">.</span><span class="n">value</span><span class="si">}</span><span class="s2">&quot;</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">measurement_system</span><span class="o">.</span><span class="n">printConsole</span><span class="p">(</span><span class="n">msg</span><span class="p">)</span>
                    <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;&gt;&gt;&quot;</span><span class="p">,</span> <span class="n">msg</span><span class="p">)</span>

                    <span class="c1"># Find channel with chart_name</span>
                    <span class="n">channel_name</span> <span class="o">=</span> <span class="n">_calculate_name</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_command_storage</span><span class="o">.</span><span class="n">channel</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">_command_storage</span><span class="o">.</span><span class="n">value</span><span class="p">)</span>

                    <span class="n">channels</span> <span class="o">=</span> <span class="p">[]</span>
                    <span class="k">for</span> <span class="n">channel</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">measurement_system</span><span class="o">.</span><span class="n">hardware_interface</span><span class="o">.</span><span class="n">multi_hardware</span><span class="o">.</span><span class="n">get_channels</span><span class="p">():</span>
                        <span class="c1"># check if channel has config attribute</span>
                        <span class="k">if</span> <span class="nb">hasattr</span><span class="p">(</span><span class="n">channel</span><span class="p">,</span> <span class="s2">&quot;config&quot;</span><span class="p">):</span>
                            <span class="k">if</span> <span class="nb">hasattr</span><span class="p">(</span><span class="n">channel</span><span class="o">.</span><span class="n">config</span><span class="p">,</span> <span class="s2">&quot;chart_number&quot;</span><span class="p">):</span>
                                <span class="k">if</span> <span class="n">channel</span><span class="o">.</span><span class="n">config</span><span class="o">.</span><span class="n">chart_number</span> <span class="o">==</span> <span class="n">channel_name</span><span class="p">:</span>
                                    <span class="n">channels</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">channel</span><span class="p">)</span>
                    <span class="c1"># channels = [ch for ch in self.measurement_system.hardware_interface.multi_hardware.get_channels() if ch.config.chart_number == channel_name]</span>

                    <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">channels</span><span class="p">)</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
                        <span class="k">raise</span> <span class="ne">Exception</span><span class="p">(</span>
                            <span class="sa">f</span><span class="s2">&quot;No channels with chart number &#39;</span><span class="si">{</span><span class="n">channel_name</span><span class="si">}</span><span class="s2">&#39; found!!!&quot;</span>
                        <span class="p">)</span>  <span class="c1"># TODO: error handling</span>

                    <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">channels</span><span class="p">)</span> <span class="o">==</span> <span class="mi">1</span><span class="p">:</span>
                        <span class="n">channel</span> <span class="o">=</span> <span class="n">channels</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>

                        <span class="bp">self</span><span class="o">.</span><span class="n">measurement_system</span><span class="o">.</span><span class="n">printConsole</span><span class="p">(</span>
                            <span class="sa">f</span><span class="s2">&quot;CH </span><span class="si">{</span><span class="n">channel_name</span><span class="si">}</span><span class="s2"> enable update: replacing </span><span class="si">{</span><span class="n">channel</span><span class="o">.</span><span class="n">config</span><span class="o">.</span><span class="n">enabled</span><span class="si">}</span><span class="s2"> with </span><span class="si">{</span><span class="n">command</span><span class="o">.</span><span class="n">value</span><span class="si">}</span><span class="s2">&quot;</span>
                        <span class="p">)</span>
                        <span class="k">with</span> <span class="bp">self</span><span class="o">.</span><span class="n">_lock</span><span class="p">:</span>
                            <span class="n">channel</span><span class="o">.</span><span class="n">config</span><span class="o">.</span><span class="n">enabled</span> <span class="o">=</span> <span class="nb">float</span><span class="p">(</span><span class="n">command</span><span class="o">.</span><span class="n">value</span><span class="p">)</span> <span class="o">==</span> <span class="mi">2</span>

                        <span class="c1"># Update Enable Anzeige</span>
                        <span class="bp">self</span><span class="o">.</span><span class="n">send_command_callback</span><span class="p">(</span><span class="n">Command</span><span class="p">(</span><span class="mi">829</span><span class="p">,</span> <span class="n">Command</span><span class="o">.</span><span class="n">Type</span><span class="o">.</span><span class="n">F</span><span class="p">,</span> <span class="nb">int</span><span class="p">(</span><span class="n">channel</span><span class="o">.</span><span class="n">config</span><span class="o">.</span><span class="n">enabled</span><span class="p">)</span> <span class="o">+</span> <span class="mi">1</span><span class="p">))</span>

                    <span class="k">else</span><span class="p">:</span>
                        <span class="k">raise</span> <span class="ne">Exception</span><span class="p">(</span>
                            <span class="sa">f</span><span class="s2">&quot;Multiple (</span><span class="si">{</span><span class="nb">len</span><span class="p">(</span><span class="n">channels</span><span class="p">)</span><span class="si">}</span><span class="s2">) channels with same chart number &#39;</span><span class="si">{</span><span class="n">channel_name</span><span class="si">}</span><span class="s2">&#39; found!!!&quot;</span>
                        <span class="p">)</span>  <span class="c1"># TODO: error handling</span>

                    <span class="c1"># Reset channel selection</span>
                    <span class="n">_reset_channel_selection</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">_command_storage</span><span class="o">.</span><span class="n">value</span> <span class="o">=</span> <span class="kc">None</span>

                <span class="k">else</span><span class="p">:</span>
                    <span class="n">msg</span> <span class="o">=</span> <span class="s2">&quot;Channel enable command received without setting chart channel first&quot;</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">measurement_system</span><span class="o">.</span><span class="n">printConsole</span><span class="p">(</span><span class="n">msg</span><span class="p">)</span>
                    <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;&gt;&gt;&quot;</span><span class="p">,</span> <span class="n">msg</span><span class="p">)</span>

            <span class="c1"># Model Selection</span>
            <span class="k">elif</span> <span class="n">command</span><span class="o">.</span><span class="n">channel</span> <span class="o">==</span> <span class="mi">831</span><span class="p">:</span>
                <span class="n">control_command</span> <span class="o">=</span> <span class="s2">&quot;&#39;model selction&#39;&quot;</span>

                <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_command_storage</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
                    <span class="n">msg</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot;Received control command for </span><span class="si">{</span><span class="n">control_command</span><span class="si">}</span><span class="s2">: value = </span><span class="si">{</span><span class="n">command</span><span class="o">.</span><span class="n">value</span><span class="si">}</span><span class="s2">&quot;</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">measurement_system</span><span class="o">.</span><span class="n">printConsole</span><span class="p">(</span><span class="n">msg</span><span class="p">)</span>
                    <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;&gt;&gt;&quot;</span><span class="p">,</span> <span class="n">msg</span><span class="p">)</span>

                    <span class="c1"># Find channel with chart_name</span>
                    <span class="n">channel_name</span> <span class="o">=</span> <span class="n">_calculate_name</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_command_storage</span><span class="o">.</span><span class="n">channel</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">_command_storage</span><span class="o">.</span><span class="n">value</span><span class="p">)</span>

                    <span class="n">channels</span> <span class="o">=</span> <span class="p">[]</span>
                    <span class="k">for</span> <span class="n">channel</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">measurement_system</span><span class="o">.</span><span class="n">hardware_interface</span><span class="o">.</span><span class="n">multi_hardware</span><span class="o">.</span><span class="n">get_channels</span><span class="p">():</span>
                        <span class="c1"># check if channel has config attribute</span>
                        <span class="k">if</span> <span class="nb">hasattr</span><span class="p">(</span><span class="n">channel</span><span class="p">,</span> <span class="s2">&quot;config&quot;</span><span class="p">):</span>
                            <span class="k">if</span> <span class="nb">hasattr</span><span class="p">(</span><span class="n">channel</span><span class="o">.</span><span class="n">config</span><span class="p">,</span> <span class="s2">&quot;chart_number&quot;</span><span class="p">):</span>
                                <span class="k">if</span> <span class="n">channel</span><span class="o">.</span><span class="n">config</span><span class="o">.</span><span class="n">chart_number</span> <span class="o">==</span> <span class="n">channel_name</span><span class="p">:</span>
                                    <span class="n">channels</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">channel</span><span class="p">)</span>
                    <span class="c1"># channels = [ch for ch in self.measurement_system.hardware_interface.multi_hardware.get_channels() if ch.config.chart_number == channel_name]</span>

                    <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">channels</span><span class="p">)</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
                        <span class="k">raise</span> <span class="ne">Exception</span><span class="p">(</span>
                            <span class="sa">f</span><span class="s2">&quot;No channels with chart number &#39;</span><span class="si">{</span><span class="n">channel_name</span><span class="si">}</span><span class="s2">&#39; found!!!&quot;</span>
                        <span class="p">)</span>  <span class="c1"># TODO: error handling</span>

                    <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">channels</span><span class="p">)</span> <span class="o">==</span> <span class="mi">1</span><span class="p">:</span>
                        <span class="n">channel</span> <span class="o">=</span> <span class="n">channels</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>

                        <span class="bp">self</span><span class="o">.</span><span class="n">measurement_system</span><span class="o">.</span><span class="n">printConsole</span><span class="p">(</span>
                            <span class="sa">f</span><span class="s2">&quot;CH </span><span class="si">{</span><span class="n">channel_name</span><span class="si">}</span><span class="s2"> </span><span class="si">{</span><span class="n">control_command</span><span class="si">}</span><span class="s2"> update: replacing </span><span class="si">{</span><span class="n">channel</span><span class="o">.</span><span class="n">model</span><span class="o">.</span><span class="n">to_string</span><span class="p">()</span><span class="si">}</span><span class="s2"> with </span><span class="si">{</span><span class="n">command</span><span class="o">.</span><span class="n">value</span><span class="si">}</span><span class="s2">&quot;</span>
                        <span class="p">)</span>

                        <span class="k">with</span> <span class="bp">self</span><span class="o">.</span><span class="n">_lock</span><span class="p">:</span>
                            <span class="n">channel</span><span class="o">.</span><span class="n">set_model_from_str</span><span class="p">(</span><span class="n">command</span><span class="o">.</span><span class="n">value</span><span class="p">)</span>

                        <span class="c1"># Update Offset Anzeige</span>
                        <span class="bp">self</span><span class="o">.</span><span class="n">send_command_callback</span><span class="p">(</span>
                            <span class="n">Command</span><span class="p">(</span>
                                <span class="n">command</span><span class="o">.</span><span class="n">channel</span> <span class="o">-</span> <span class="mi">10</span><span class="p">,</span>
                                <span class="n">Command</span><span class="o">.</span><span class="n">Type</span><span class="o">.</span><span class="n">S</span><span class="p">,</span>
                                <span class="sa">f</span><span class="s2">&quot;Model: </span><span class="si">{</span><span class="n">channel</span><span class="o">.</span><span class="n">model</span><span class="o">.</span><span class="n">to_string</span><span class="p">()</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">,</span>
                            <span class="p">)</span>
                        <span class="p">)</span>

                    <span class="k">else</span><span class="p">:</span>
                        <span class="k">raise</span> <span class="ne">Exception</span><span class="p">(</span>
                            <span class="sa">f</span><span class="s2">&quot;Multiple (</span><span class="si">{</span><span class="nb">len</span><span class="p">(</span><span class="n">channels</span><span class="p">)</span><span class="si">}</span><span class="s2">) channels with same chart number &#39;</span><span class="si">{</span><span class="n">channel_name</span><span class="si">}</span><span class="s2">&#39; found!!!&quot;</span>
                        <span class="p">)</span>  <span class="c1"># TODO: error handling</span>

                    <span class="c1"># Reset channel selection</span>
                    <span class="n">_reset_channel_selection</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">_command_storage</span><span class="o">.</span><span class="n">value</span> <span class="o">=</span> <span class="kc">None</span>

                <span class="k">else</span><span class="p">:</span>
                    <span class="n">msg</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">control_command</span><span class="si">}</span><span class="s2"> command received without setting chart channel first&quot;</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">measurement_system</span><span class="o">.</span><span class="n">printConsole</span><span class="p">(</span><span class="n">msg</span><span class="p">)</span>
                    <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;&gt;&gt;&quot;</span><span class="p">,</span> <span class="n">msg</span><span class="p">)</span>

            <span class="c1"># SampleRate Selection</span>
            <span class="k">elif</span> <span class="n">command</span><span class="o">.</span><span class="n">channel</span> <span class="o">==</span> <span class="mi">833</span><span class="p">:</span>
                <span class="n">control_command</span> <span class="o">=</span> <span class="s2">&quot;&#39;sample rate selection&#39;&quot;</span>

                <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_command_storage</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
                    <span class="n">msg</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot;Received control command for </span><span class="si">{</span><span class="n">control_command</span><span class="si">}</span><span class="s2">: value = </span><span class="si">{</span><span class="n">command</span><span class="o">.</span><span class="n">value</span><span class="si">}</span><span class="s2">&quot;</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">measurement_system</span><span class="o">.</span><span class="n">printConsole</span><span class="p">(</span><span class="n">msg</span><span class="p">)</span>
                    <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;&gt;&gt;&quot;</span><span class="p">,</span> <span class="n">msg</span><span class="p">)</span>

                    <span class="c1"># Find channel with chart_name</span>
                    <span class="n">channel_name</span> <span class="o">=</span> <span class="n">_calculate_name</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_command_storage</span><span class="o">.</span><span class="n">channel</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">_command_storage</span><span class="o">.</span><span class="n">value</span><span class="p">)</span>

                    <span class="n">channels</span> <span class="o">=</span> <span class="p">[]</span>
                    <span class="k">for</span> <span class="n">channel</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">measurement_system</span><span class="o">.</span><span class="n">hardware_interface</span><span class="o">.</span><span class="n">multi_hardware</span><span class="o">.</span><span class="n">get_channels</span><span class="p">():</span>
                        <span class="c1"># check if channel has config attribute</span>
                        <span class="k">if</span> <span class="nb">hasattr</span><span class="p">(</span><span class="n">channel</span><span class="p">,</span> <span class="s2">&quot;config&quot;</span><span class="p">):</span>
                            <span class="k">if</span> <span class="nb">hasattr</span><span class="p">(</span><span class="n">channel</span><span class="o">.</span><span class="n">config</span><span class="p">,</span> <span class="s2">&quot;chart_number&quot;</span><span class="p">):</span>
                                <span class="k">if</span> <span class="n">channel</span><span class="o">.</span><span class="n">config</span><span class="o">.</span><span class="n">chart_number</span> <span class="o">==</span> <span class="n">channel_name</span><span class="p">:</span>
                                    <span class="n">channels</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">channel</span><span class="p">)</span>

                    <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">channels</span><span class="p">)</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
                        <span class="k">raise</span> <span class="ne">Exception</span><span class="p">(</span>
                            <span class="sa">f</span><span class="s2">&quot;No channels with chart number &#39;</span><span class="si">{</span><span class="n">channel_name</span><span class="si">}</span><span class="s2">&#39; found!!!&quot;</span>
                        <span class="p">)</span>  <span class="c1"># TODO: error handling</span>

                    <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">channels</span><span class="p">)</span> <span class="o">==</span> <span class="mi">1</span><span class="p">:</span>
                        <span class="n">channel</span> <span class="o">=</span> <span class="n">channels</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>

                        <span class="bp">self</span><span class="o">.</span><span class="n">measurement_system</span><span class="o">.</span><span class="n">printConsole</span><span class="p">(</span>
                            <span class="sa">f</span><span class="s2">&quot;CH </span><span class="si">{</span><span class="n">channel_name</span><span class="si">}</span><span class="s2"> </span><span class="si">{</span><span class="n">control_command</span><span class="si">}</span><span class="s2"> update: replacing </span><span class="si">{</span><span class="n">channel</span><span class="o">.</span><span class="n">config</span><span class="o">.</span><span class="n">sample_rate</span><span class="si">}</span><span class="s2"> with </span><span class="si">{</span><span class="n">command</span><span class="o">.</span><span class="n">value</span><span class="si">}</span><span class="s2">&quot;</span>
                        <span class="p">)</span>
                        <span class="k">with</span> <span class="bp">self</span><span class="o">.</span><span class="n">_lock</span><span class="p">:</span>
                            <span class="n">channel</span><span class="o">.</span><span class="n">config</span><span class="o">.</span><span class="n">sample_rate</span> <span class="o">=</span> <span class="nb">float</span><span class="p">(</span><span class="n">command</span><span class="o">.</span><span class="n">value</span><span class="p">)</span>

                        <span class="c1"># Update SampleRate Anzeige</span>
                        <span class="bp">self</span><span class="o">.</span><span class="n">send_command_callback</span><span class="p">(</span>
                            <span class="n">Command</span><span class="p">(</span>
                                <span class="n">command</span><span class="o">.</span><span class="n">channel</span> <span class="o">-</span> <span class="mi">10</span><span class="p">,</span>
                                <span class="n">Command</span><span class="o">.</span><span class="n">Type</span><span class="o">.</span><span class="n">S</span><span class="p">,</span>
                                <span class="sa">f</span><span class="s2">&quot;SR: </span><span class="si">{</span><span class="n">channel</span><span class="o">.</span><span class="n">config</span><span class="o">.</span><span class="n">sample_rate</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">,</span>
                            <span class="p">)</span>
                        <span class="p">)</span>

                    <span class="k">else</span><span class="p">:</span>
                        <span class="k">raise</span> <span class="ne">Exception</span><span class="p">(</span>
                            <span class="sa">f</span><span class="s2">&quot;Multiple (</span><span class="si">{</span><span class="nb">len</span><span class="p">(</span><span class="n">channels</span><span class="p">)</span><span class="si">}</span><span class="s2">) channels with same chart number &#39;</span><span class="si">{</span><span class="n">channel_name</span><span class="si">}</span><span class="s2">&#39; found!!!&quot;</span>
                        <span class="p">)</span>  <span class="c1"># TODO: error handling</span>

                    <span class="c1"># Reset channel selection</span>
                    <span class="n">_reset_channel_selection</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">_command_storage</span><span class="o">.</span><span class="n">value</span> <span class="o">=</span> <span class="kc">None</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="n">msg</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">control_command</span><span class="si">}</span><span class="s2"> command received without setting chart channel first&quot;</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">measurement_system</span><span class="o">.</span><span class="n">printConsole</span><span class="p">(</span><span class="n">msg</span><span class="p">)</span>
                    <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;&gt;&gt;&quot;</span><span class="p">,</span> <span class="n">msg</span><span class="p">)</span>

            <span class="c1"># SAVE CONFIG</span>
            <span class="k">elif</span> <span class="n">command</span><span class="o">.</span><span class="n">channel</span> <span class="o">==</span> <span class="mi">890</span><span class="p">:</span>
                <span class="n">hardware_file</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">current_dir</span><span class="p">,</span> <span class="s2">&quot;config&quot;</span><span class="p">,</span> <span class="s2">&quot;hardware_user.json&quot;</span><span class="p">)</span>
                <span class="n">channels_file</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">current_dir</span><span class="p">,</span> <span class="s2">&quot;config&quot;</span><span class="p">,</span> <span class="s2">&quot;channels_user.json&quot;</span><span class="p">)</span>
                <span class="n">modules_file</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">current_dir</span><span class="p">,</span> <span class="s2">&quot;config&quot;</span><span class="p">,</span> <span class="s2">&quot;modules_user.json&quot;</span><span class="p">)</span>

                <span class="bp">self</span><span class="o">.</span><span class="n">measurement_system</span><span class="o">.</span><span class="n">hardware_interface</span><span class="o">.</span><span class="n">to_json</span><span class="p">(</span>
                    <span class="n">hardware_file</span><span class="o">=</span><span class="n">hardware_file</span><span class="p">,</span>
                    <span class="n">channels_file</span><span class="o">=</span><span class="n">channels_file</span><span class="p">,</span>
                    <span class="n">modules_file</span><span class="o">=</span><span class="n">modules_file</span><span class="p">,</span>
                <span class="p">)</span>

                <span class="n">msg</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot;Saving config to &#39;</span><span class="si">{</span><span class="n">hardware_file</span><span class="si">}</span><span class="s2">&#39;, &#39;</span><span class="si">{</span><span class="n">channels_file</span><span class="si">}</span><span class="s2">&#39; and &#39;</span><span class="si">{</span><span class="n">modules_file</span><span class="si">}</span><span class="s2">&#39;&quot;</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">measurement_system</span><span class="o">.</span><span class="n">printConsole</span><span class="p">(</span><span class="n">msg</span><span class="p">)</span>
                <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;&gt;&gt;&quot;</span><span class="p">,</span> <span class="n">msg</span><span class="p">)</span>

            <span class="c1"># LOAD CONFIG</span>
            <span class="k">elif</span> <span class="mi">891</span> <span class="o">&lt;=</span> <span class="n">command</span><span class="o">.</span><span class="n">channel</span> <span class="o">&lt;=</span> <span class="mi">892</span><span class="p">:</span>
                <span class="k">if</span> <span class="n">command</span><span class="o">.</span><span class="n">channel</span> <span class="o">==</span> <span class="mi">892</span><span class="p">:</span>  <span class="c1"># default config</span>
                    <span class="n">name_postfix</span> <span class="o">=</span> <span class="s2">&quot;_default&quot;</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="n">name_postfix</span> <span class="o">=</span> <span class="s2">&quot;_user&quot;</span>  <span class="c1"># user defined</span>
                <span class="n">hardware_file</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">current_dir</span><span class="p">,</span> <span class="s2">&quot;config&quot;</span><span class="p">,</span> <span class="sa">f</span><span class="s2">&quot;hardware</span><span class="si">{</span><span class="n">name_postfix</span><span class="si">}</span><span class="s2">.json&quot;</span><span class="p">)</span>
                <span class="n">channels_file</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">current_dir</span><span class="p">,</span> <span class="s2">&quot;config&quot;</span><span class="p">,</span> <span class="sa">f</span><span class="s2">&quot;channels</span><span class="si">{</span><span class="n">name_postfix</span><span class="si">}</span><span class="s2">.json&quot;</span><span class="p">)</span>
                <span class="n">modules_file</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">current_dir</span><span class="p">,</span> <span class="s2">&quot;config&quot;</span><span class="p">,</span> <span class="sa">f</span><span class="s2">&quot;modules</span><span class="si">{</span><span class="n">name_postfix</span><span class="si">}</span><span class="s2">.json&quot;</span><span class="p">)</span>

                <span class="n">msg</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot;Loading config from &#39;</span><span class="si">{</span><span class="n">hardware_file</span><span class="si">}</span><span class="s2">&#39;, &#39;</span><span class="si">{</span><span class="n">channels_file</span><span class="si">}</span><span class="s2">&#39; and &#39;</span><span class="si">{</span><span class="n">modules_file</span><span class="si">}</span><span class="s2">&#39;&quot;</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">measurement_system</span><span class="o">.</span><span class="n">printConsole</span><span class="p">(</span><span class="n">msg</span><span class="p">)</span>
                <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;&gt;&gt;&quot;</span><span class="p">,</span> <span class="n">msg</span><span class="p">)</span>

                <span class="c1"># Stop measurement tasks and close hardware interface</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">measurement_system</span><span class="o">.</span><span class="n">measurement_task_manager</span><span class="o">.</span><span class="n">stop_tasks</span><span class="p">()</span>  <span class="c1"># stop measurement tasks</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">measurement_system</span><span class="o">.</span><span class="n">hardware_interface</span><span class="o">.</span><span class="n">close</span><span class="p">()</span>  <span class="c1"># close hardware interface</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">measurement_system</span><span class="o">.</span><span class="n">init_comvisu</span><span class="p">()</span>  <span class="c1"># init comvisu</span>

                <span class="c1"># Load config and initialize new hardware interface</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">measurement_system</span><span class="o">.</span><span class="n">hardware_interface</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">measurement_system</span><span class="o">.</span><span class="n">hardware_interface</span><span class="o">.</span><span class="n">from_json</span><span class="p">(</span>
                    <span class="n">hardware_file</span><span class="o">=</span><span class="n">hardware_file</span><span class="p">,</span>
                    <span class="n">channels_file</span><span class="o">=</span><span class="n">channels_file</span><span class="p">,</span>
                    <span class="n">modules_file</span><span class="o">=</span><span class="n">modules_file</span><span class="p">,</span>
                <span class="p">)</span>

                <span class="c1"># Recreate measurement tasks</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">measurement_system</span><span class="o">.</span><span class="n">measurement_task_manager</span><span class="o">.</span><span class="n">initialize_tasks</span><span class="p">()</span>

            <span class="c1">##################################</span>
            <span class="c1"># IMPLEMENT MORE CONTROL COMMANDS HERE</span>
            <span class="c1"># elif command.channel == ...:</span>

            <span class="k">else</span><span class="p">:</span>
                <span class="n">msg</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot;Unknown control command: </span><span class="si">{</span><span class="n">command</span><span class="o">.</span><span class="n">to_string</span><span class="p">()</span><span class="si">}</span><span class="s2">&quot;</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">measurement_system</span><span class="o">.</span><span class="n">printConsole</span><span class="p">(</span><span class="n">msg</span><span class="p">)</span>
                <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;&gt;&gt;&quot;</span><span class="p">,</span> <span class="n">msg</span><span class="p">)</span>

        <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
            <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Error executing command: </span><span class="si">{</span><span class="n">command</span><span class="o">.</span><span class="n">to_string</span><span class="p">()</span><span class="si">}</span><span class="s2">, error: </span><span class="si">{</span><span class="n">e</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span></div>



<div class="viewcode-block" id="ControlTaskManager">
<a class="viewcode-back" href="../../reference.html#MeasurementSystem.measurement_server.ControlTaskManager">[docs]</a>
<span class="k">class</span> <span class="nc">ControlTaskManager</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Manages a collection of control tasks and provides functionality to start and stop them all.</span>

<span class="sd">    :param measurement_system: An instance of MeasurementSystem class.</span>
<span class="sd">    :type measurement_system: MeasurementSystem</span>

<span class="sd">    :return: ControlTaskManager instance</span>
<span class="sd">    :rtype: ControlTaskManager</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">measurement_system</span><span class="p">:</span> <span class="n">MeasurementSystem</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">measurement_system</span> <span class="o">=</span> <span class="n">measurement_system</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">send_command_callback</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">measurement_system</span><span class="o">.</span><span class="n">add_command_to_send_queue</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">tasks</span> <span class="o">=</span> <span class="p">[]</span>

<div class="viewcode-block" id="ControlTaskManager.initialize_tasks">
<a class="viewcode-back" href="../../reference.html#MeasurementSystem.measurement_server.ControlTaskManager.initialize_tasks">[docs]</a>
    <span class="k">def</span> <span class="nf">initialize_tasks</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Initialize the control tasks.</span>

<span class="sd">        :return: None</span>
<span class="sd">        :rtype: None</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="n">task</span> <span class="o">=</span> <span class="n">ControlTask</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">measurement_system</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">send_command_callback</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">tasks</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">task</span><span class="p">)</span></div>


<div class="viewcode-block" id="ControlTaskManager.start_tasks">
<a class="viewcode-back" href="../../reference.html#MeasurementSystem.measurement_server.ControlTaskManager.start_tasks">[docs]</a>
    <span class="k">def</span> <span class="nf">start_tasks</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Start all control tasks.</span>

<span class="sd">        This method iterates over all control tasks in the tasks list and calls</span>
<span class="sd">        their start method.</span>

<span class="sd">        :return: None</span>
<span class="sd">        :rtype: None</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="k">for</span> <span class="n">task</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">tasks</span><span class="p">:</span>
            <span class="k">assert</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">task</span><span class="p">,</span> <span class="n">ControlTask</span><span class="p">)</span>
            <span class="n">task</span><span class="o">.</span><span class="n">start</span><span class="p">()</span></div>


<div class="viewcode-block" id="ControlTaskManager.stop_tasks">
<a class="viewcode-back" href="../../reference.html#MeasurementSystem.measurement_server.ControlTaskManager.stop_tasks">[docs]</a>
    <span class="k">def</span> <span class="nf">stop_tasks</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Stop all control tasks.</span>

<span class="sd">        This method iterates over all control tasks in the tasks list and calls</span>
<span class="sd">        their stop method.</span>

<span class="sd">        :return: None</span>
<span class="sd">        :rtype: None</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="k">for</span> <span class="n">task</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">tasks</span><span class="p">:</span>
            <span class="k">assert</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">task</span><span class="p">,</span> <span class="n">ControlTask</span><span class="p">)</span>
            <span class="n">task</span><span class="o">.</span><span class="n">stop</span><span class="p">()</span></div>


<div class="viewcode-block" id="ControlTaskManager.add_command_to_task">
<a class="viewcode-back" href="../../reference.html#MeasurementSystem.measurement_server.ControlTaskManager.add_command_to_task">[docs]</a>
    <span class="k">def</span> <span class="nf">add_command_to_task</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">command</span><span class="p">:</span> <span class="n">Command</span><span class="p">,</span> <span class="n">priority</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="mi">5</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Add a command to the control task.</span>

<span class="sd">        This method adds a command to the control task with a given priority.</span>
<span class="sd">        The control task will execute the command in the order of priority.</span>

<span class="sd">        :param command: The command to add to the control task.</span>
<span class="sd">        :type command: Command</span>
<span class="sd">        :param priority: The priority of the command. Higher priority commands are executed first.</span>
<span class="sd">        :type priority: int</span>
<span class="sd">        :return: None</span>
<span class="sd">        :rtype: None</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="k">for</span> <span class="n">task</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">tasks</span><span class="p">:</span>
            <span class="k">assert</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">task</span><span class="p">,</span> <span class="n">ControlTask</span><span class="p">)</span>
            <span class="n">task</span><span class="o">.</span><span class="n">add_command</span><span class="p">(</span><span class="n">command</span><span class="p">)</span></div>
</div>



<div class="viewcode-block" id="MeasurementSystem">
<a class="viewcode-back" href="../../reference.html#MeasurementSystem.measurement_server.MeasurementSystem">[docs]</a>
<span class="k">class</span> <span class="nc">MeasurementSystem</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Represents a measurement system that collects and processes data from various measurement sources.</span>

<span class="sd">    The MeasurementSystem class provides a framework for managing measurement data, including data acquisition,</span>
<span class="sd">    processing, and storage. It can be used to integrate data from multiple measurement sources, such as sensors,</span>
<span class="sd">    instruments, or other data acquisition systems.</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">server_address</span><span class="p">):</span>
        <span class="c1"># Server Connection</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Initialize a MeasurementSystem object.</span>

<span class="sd">        This method initializes a MeasurementSystem object with a given server</span>
<span class="sd">        address. It creates a ServerConnection object, a DataQueue object, a</span>
<span class="sd">        DataQueueThread object and a HardwareInterface object. It also</span>
<span class="sd">        initializes a MeasurementTaskManager and a ControlTaskManager object.</span>

<span class="sd">        :param server_address: The address of the server to connect to.</span>
<span class="sd">        :type server_address: str</span>
<span class="sd">        :return: None</span>
<span class="sd">        :rtype: None</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">server_connection</span> <span class="o">=</span> <span class="n">ServerConnection</span><span class="p">(</span><span class="s2">&quot;ComVisu&quot;</span><span class="p">,</span> <span class="n">server_address</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">server_connection</span><span class="o">.</span><span class="n">connect</span><span class="p">()</span>

        <span class="c1"># Data Queue</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">data_queue</span> <span class="o">=</span> <span class="n">OrderedPriorityQueue</span><span class="p">(</span><span class="n">name</span><span class="o">=</span><span class="s2">&quot;DataQueue&quot;</span><span class="p">)</span>

        <span class="c1"># Send Thread</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">data_queue_processor</span> <span class="o">=</span> <span class="n">DataQueueThread</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">data_queue</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">server_connection</span><span class="o">.</span><span class="n">send</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">data_queue_processor</span><span class="o">.</span><span class="n">start</span><span class="p">()</span>

        <span class="c1"># Hardware Interface</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">hardware_interface</span> <span class="o">=</span> <span class="n">HardwareInterface</span><span class="p">(</span><span class="n">name</span><span class="o">=</span><span class="s2">&quot;MeasurementSystemInterface&quot;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">hardware_interface</span><span class="o">.</span><span class="n">initialize</span><span class="p">()</span>  <span class="c1"># TODO: to be replaced by reading a json file (default.json if no correct config file is provided)</span>

        <span class="c1"># Measurement Task Manager</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">measurement_task_manager</span> <span class="o">=</span> <span class="n">MeasurementTaskManager</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span>
        <span class="c1"># NOTE: tasks are initialized at measurement start</span>

        <span class="c1"># Control Task</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">control_task_manager</span> <span class="o">=</span> <span class="n">ControlTaskManager</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">control_task_manager</span><span class="o">.</span><span class="n">initialize_tasks</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">control_task_manager</span><span class="o">.</span><span class="n">start_tasks</span><span class="p">()</span>

        <span class="c1"># Initialize ComVisu</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">init_comvisu</span><span class="p">()</span>

<div class="viewcode-block" id="MeasurementSystem.close">
<a class="viewcode-back" href="../../reference.html#MeasurementSystem.measurement_server.MeasurementSystem.close">[docs]</a>
    <span class="k">def</span> <span class="nf">close</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Close the MeasurementSystem object.</span>

<span class="sd">        This method stops all measurement tasks and control tasks,</span>
<span class="sd">        closes the hardware interface, stops the data queue processor and</span>
<span class="sd">        disconnects from the server.</span>

<span class="sd">        :return: None</span>
<span class="sd">        :rtype: None</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">measurement_task_manager</span><span class="o">.</span><span class="n">stop_tasks</span><span class="p">()</span>  <span class="c1"># stop measurement tasks</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">control_task_manager</span><span class="o">.</span><span class="n">stop_tasks</span><span class="p">()</span>  <span class="c1"># stop control tasks</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">hardware_interface</span><span class="o">.</span><span class="n">close</span><span class="p">()</span>  <span class="c1"># close measurement</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">data_queue_processor</span><span class="o">.</span><span class="n">stop</span><span class="p">()</span>  <span class="c1"># stop data queue processor</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">server_connection</span><span class="o">.</span><span class="n">disconnect</span><span class="p">()</span>  <span class="c1"># close server connection</span></div>


<div class="viewcode-block" id="MeasurementSystem.printConsole">
<a class="viewcode-back" href="../../reference.html#MeasurementSystem.measurement_server.MeasurementSystem.printConsole">[docs]</a>
    <span class="k">def</span> <span class="nf">printConsole</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="n">sep</span><span class="o">=</span><span class="s2">&quot; &quot;</span><span class="p">,</span> <span class="n">end</span><span class="o">=</span><span class="s2">&quot;&quot;</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Prints a message to the ComVisu console #999 with a timestamp and replaces any semicolons or hashes in the message with underscores.</span>

<span class="sd">        :param args: The arguments to be joined into a message string.</span>
<span class="sd">        :type args: Any</span>
<span class="sd">        :param sep: The separator to join the arguments with. Default is a space.</span>
<span class="sd">        :type sep: str</span>
<span class="sd">        :param end: The string to append to the end of the message. Default is an empty string.</span>
<span class="sd">        :type end: str</span>
<span class="sd">        :return: None</span>
<span class="sd">        :rtype: None</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="n">message</span> <span class="o">=</span> <span class="n">sep</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="nb">map</span><span class="p">(</span><span class="nb">str</span><span class="p">,</span> <span class="n">args</span><span class="p">))</span> <span class="o">+</span> <span class="n">end</span>

        <span class="c1"># replace not allowed characters</span>
        <span class="n">message</span> <span class="o">=</span> <span class="n">message</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s2">&quot;;&quot;</span><span class="p">,</span> <span class="s2">&quot;_&quot;</span><span class="p">)</span>
        <span class="n">message</span> <span class="o">=</span> <span class="n">message</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s2">&quot;#&quot;</span><span class="p">,</span> <span class="s2">&quot;_&quot;</span><span class="p">)</span>

        <span class="n">timestamp</span> <span class="o">=</span> <span class="n">datetime</span><span class="o">.</span><span class="n">now</span><span class="p">()</span><span class="o">.</span><span class="n">strftime</span><span class="p">(</span><span class="s2">&quot;%Y-%m-</span><span class="si">%d</span><span class="s2">, %H:%M:%S.</span><span class="si">%f</span><span class="s2">&quot;</span><span class="p">)</span>
        <span class="n">message</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">timestamp</span><span class="si">}</span><span class="s2">: </span><span class="si">{</span><span class="n">message</span><span class="si">}</span><span class="s2">&quot;</span>

        <span class="n">cmd</span> <span class="o">=</span> <span class="n">Command</span><span class="p">(</span><span class="mi">999</span><span class="p">,</span> <span class="n">Command</span><span class="o">.</span><span class="n">Type</span><span class="o">.</span><span class="n">STRING</span><span class="p">,</span> <span class="n">message</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">add_command_to_send_queue</span><span class="p">(</span><span class="n">cmd</span><span class="p">,</span> <span class="n">priority</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span></div>


<div class="viewcode-block" id="MeasurementSystem.add_command_to_send_queue">
<a class="viewcode-back" href="../../reference.html#MeasurementSystem.measurement_server.MeasurementSystem.add_command_to_send_queue">[docs]</a>
    <span class="k">def</span> <span class="nf">add_command_to_send_queue</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">command</span><span class="p">:</span> <span class="n">Command</span><span class="p">,</span> <span class="n">priority</span><span class="o">=</span><span class="mi">5</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Sends a command to the server with a given priority.</span>

<span class="sd">        :param command: The command to send to the server.</span>
<span class="sd">        :type command: Command</span>
<span class="sd">        :param priority: The priority of the command. Higher priority commands are executed first.</span>
<span class="sd">        :type priority: int</span>
<span class="sd">        :return: None</span>
<span class="sd">        :rtype: None</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">data_queue</span><span class="o">.</span><span class="n">put</span><span class="p">(</span><span class="n">command</span><span class="p">,</span> <span class="n">priority</span><span class="p">)</span></div>


<div class="viewcode-block" id="MeasurementSystem.init_comvisu">
<a class="viewcode-back" href="../../reference.html#MeasurementSystem.measurement_server.MeasurementSystem.init_comvisu">[docs]</a>
    <span class="k">def</span> <span class="nf">init_comvisu</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Initialize the ComVisu server.</span>

<span class="sd">        This method sends commands to the server to initialize the ComVisu interface.</span>
<span class="sd">        The commands are sent with priority 0.</span>

<span class="sd">        The following commands are sent:</span>
<span class="sd">            - Set &quot;Mess-System&quot; to &quot;STOP&quot;.</span>
<span class="sd">            - Set &quot;Diagramm X - Kanal auswahl&quot; to &quot;-&quot; for all diagrams.</span>
<span class="sd">            - Set &quot;Kanal X: Enable&quot; to &quot;-&quot;.</span>
<span class="sd">            - Clear all diagrams.</span>

<span class="sd">        :return: None</span>
<span class="sd">        :rtype: None</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">add_command_to_send_queue</span><span class="p">(</span><span class="n">Command</span><span class="p">(</span><span class="mi">901</span><span class="p">,</span> <span class="n">Command</span><span class="o">.</span><span class="n">Type</span><span class="o">.</span><span class="n">FLOAT</span><span class="p">,</span> <span class="mi">1</span><span class="p">),</span> <span class="n">priority</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span>  <span class="c1"># set &quot;Mess-System&quot; to &quot;STOP&quot;</span>

        <span class="k">for</span> <span class="n">ch</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">811</span><span class="p">,</span> <span class="mi">816</span><span class="p">):</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">add_command_to_send_queue</span><span class="p">(</span>
                <span class="n">Command</span><span class="p">(</span><span class="n">ch</span><span class="p">,</span> <span class="n">Command</span><span class="o">.</span><span class="n">Type</span><span class="o">.</span><span class="n">FLOAT</span><span class="p">,</span> <span class="mi">0</span><span class="p">),</span> <span class="n">priority</span><span class="o">=</span><span class="mi">0</span>
            <span class="p">)</span>  <span class="c1"># set &quot;Diagramm X - Kanal auswahl&quot; to &quot;-&quot;</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">add_command_to_send_queue</span><span class="p">(</span><span class="n">Command</span><span class="p">(</span><span class="mi">829</span><span class="p">,</span> <span class="n">Command</span><span class="o">.</span><span class="n">Type</span><span class="o">.</span><span class="n">FLOAT</span><span class="p">,</span> <span class="mi">0</span><span class="p">),</span> <span class="n">priority</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span>  <span class="c1"># set &quot;Kanal X: Enable&quot; to &quot;-&quot;</span>

        <span class="k">for</span> <span class="n">ch</span> <span class="ow">in</span> <span class="p">[</span><span class="mi">700</span><span class="p">,</span> <span class="mi">720</span><span class="p">,</span> <span class="mi">740</span><span class="p">,</span> <span class="mi">760</span><span class="p">,</span> <span class="mi">780</span><span class="p">]:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">add_command_to_send_queue</span><span class="p">(</span><span class="n">Command</span><span class="p">(</span><span class="n">ch</span><span class="p">,</span> <span class="n">Command</span><span class="o">.</span><span class="n">Type</span><span class="o">.</span><span class="n">STRING</span><span class="p">,</span> <span class="s2">&quot;Clear&quot;</span><span class="p">),</span> <span class="n">priority</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span>  <span class="c1"># clear all diagrams</span></div>


        <span class="c1">##################################</span>
        <span class="c1"># IMPLEMENT MORE COMMANDS HERE</span>

<div class="viewcode-block" id="MeasurementSystem.process_commands">
<a class="viewcode-back" href="../../reference.html#MeasurementSystem.measurement_server.MeasurementSystem.process_commands">[docs]</a>
    <span class="k">def</span> <span class="nf">process_commands</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">commands</span><span class="p">:</span> <span class="n">List</span><span class="p">[</span><span class="n">Command</span><span class="p">])</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Process commands received from the ComVisu server.</span>

<span class="sd">        This method processes commands received from the ComVisu server.</span>
<span class="sd">        The commands are processed according to the channel number and type.</span>

<span class="sd">        The following commands are processed:</span>
<span class="sd">            - Start/Stop Measurement System</span>
<span class="sd">            - Slider Test</span>
<span class="sd">            - Control Commands - Calibration</span>
<span class="sd">            - Keep Alive Signal</span>

<span class="sd">        Other commands are logged as &quot;Unknown command&quot;.</span>

<span class="sd">        :param commands: The commands to process.</span>
<span class="sd">        :type commands: List[Command]</span>
<span class="sd">        :return: None</span>
<span class="sd">        :rtype: None</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="k">for</span> <span class="n">command</span> <span class="ow">in</span> <span class="n">commands</span><span class="p">:</span>
            <span class="c1">##################################</span>
            <span class="c1"># Start/Stop Measurement System</span>
            <span class="k">if</span> <span class="n">command</span><span class="o">.</span><span class="n">channel</span> <span class="o">==</span> <span class="mi">900</span><span class="p">:</span>  <span class="c1"># Start Measurement System</span>
                <span class="k">if</span> <span class="n">command</span><span class="o">.</span><span class="n">value</span> <span class="o">==</span> <span class="mi">2</span><span class="p">:</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">measurement_task_manager</span><span class="o">.</span><span class="n">initialize_tasks</span><span class="p">()</span>  <span class="c1"># NOTE: in case of anything has changes in the meanwhile</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">measurement_task_manager</span><span class="o">.</span><span class="n">start_tasks</span><span class="p">()</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">printConsole</span><span class="p">(</span><span class="s2">&quot;Measurement system started&quot;</span><span class="p">)</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">measurement_task_manager</span><span class="o">.</span><span class="n">stop_tasks</span><span class="p">()</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">printConsole</span><span class="p">(</span><span class="s2">&quot;Measurement system stopped&quot;</span><span class="p">)</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">add_command_to_send_queue</span><span class="p">(</span><span class="n">Command</span><span class="p">(</span><span class="mi">901</span><span class="p">,</span> <span class="n">Command</span><span class="o">.</span><span class="n">Type</span><span class="o">.</span><span class="n">F</span><span class="p">,</span> <span class="s2">&quot;0&quot;</span><span class="p">),</span> <span class="n">priority</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span>

            <span class="c1">##################################</span>
            <span class="c1"># Slider Test</span>
            <span class="k">elif</span> <span class="n">command</span><span class="o">.</span><span class="n">channel</span> <span class="o">==</span> <span class="mi">510</span><span class="p">:</span>  <span class="c1"># == &quot;#510F12;&quot;</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">printConsole</span><span class="p">(</span>
                    <span class="s2">&quot;Channel: &quot;</span><span class="p">,</span>
                    <span class="n">command</span><span class="o">.</span><span class="n">channel</span><span class="p">,</span>
                    <span class="s2">&quot;, type: &quot;</span><span class="p">,</span>
                    <span class="n">command</span><span class="o">.</span><span class="n">type</span><span class="p">,</span>
                    <span class="s2">&quot;, value:&quot;</span><span class="p">,</span>
                    <span class="n">command</span><span class="o">.</span><span class="n">value</span><span class="p">,</span>
                <span class="p">)</span>

                <span class="c1"># # TEST: overwrite gain value of InternalTemperatureChannel</span>
                <span class="c1"># channel = self.hardware_interface._rpi_hardware.channels[1]</span>
                <span class="c1"># channel.gain = command.value</span>

            <span class="c1">##################################</span>
            <span class="c1"># Control Commands - Calibration</span>
            <span class="k">elif</span> <span class="n">command</span><span class="o">.</span><span class="n">channel</span> <span class="o">&gt;=</span> <span class="mi">800</span> <span class="ow">and</span> <span class="n">command</span><span class="o">.</span><span class="n">channel</span> <span class="o">&lt;=</span> <span class="mi">899</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">printConsole</span><span class="p">(</span>
                    <span class="s2">&quot;Channel: &quot;</span><span class="p">,</span>
                    <span class="n">command</span><span class="o">.</span><span class="n">channel</span><span class="p">,</span>
                    <span class="s2">&quot;, type: &quot;</span><span class="p">,</span>
                    <span class="n">command</span><span class="o">.</span><span class="n">type</span><span class="p">,</span>
                    <span class="s2">&quot;, value:&quot;</span><span class="p">,</span>
                    <span class="n">command</span><span class="o">.</span><span class="n">value</span><span class="p">,</span>
                <span class="p">)</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">control_task_manager</span><span class="o">.</span><span class="n">add_command_to_task</span><span class="p">(</span><span class="n">command</span><span class="p">)</span>

            <span class="c1">##################################</span>
            <span class="c1"># Keep Alive Signal</span>
            <span class="k">elif</span> <span class="n">command</span><span class="o">.</span><span class="n">channel</span> <span class="o">==</span> <span class="mi">980</span><span class="p">:</span>  <span class="c1"># Keep alive signal received</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">add_command_to_send_queue</span><span class="p">(</span>
                    <span class="n">Command</span><span class="p">(</span><span class="mi">981</span><span class="p">,</span> <span class="n">Command</span><span class="o">.</span><span class="n">Type</span><span class="o">.</span><span class="n">FLOAT</span><span class="p">,</span> <span class="s2">&quot;1&quot;</span><span class="p">),</span> <span class="n">priority</span><span class="o">=</span><span class="mi">0</span>
                <span class="p">)</span>  <span class="c1"># send Mess-Sytem-KeepAlive Signal</span>

                <span class="c1"># Blink LED</span>
                <span class="n">channel</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">hardware_interface</span><span class="o">.</span><span class="n">multi_hardware</span><span class="o">.</span><span class="n">get_channels_by_name</span><span class="p">(</span><span class="s2">&quot;KeepAliveLED&quot;</span><span class="p">)</span>
                <span class="k">try</span><span class="p">:</span>
                    <span class="n">channel</span> <span class="o">=</span> <span class="nb">next</span><span class="p">(</span><span class="n">channel</span><span class="p">)</span>  <span class="c1"># Generator to item</span>
                    <span class="k">assert</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">channel</span><span class="p">,</span> <span class="n">Channel_RPI_DigitalOutput</span><span class="p">)</span>
                    <span class="k">if</span> <span class="n">channel</span><span class="o">.</span><span class="n">level</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
                        <span class="n">channel</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span>
                    <span class="k">else</span><span class="p">:</span>
                        <span class="n">channel</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span>
                <span class="k">except</span><span class="p">:</span>
                    <span class="k">pass</span>

            <span class="c1">##################################</span>
            <span class="c1"># IMPLEMENT MORE COMMANDS HERE</span>
            <span class="c1"># elif command.channel == ...:</span>

            <span class="c1">##################################</span>
            <span class="c1"># Unknown Command</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">printConsole</span><span class="p">(</span><span class="s2">&quot;Unknown command:&quot;</span><span class="p">,</span> <span class="n">command</span><span class="p">)</span>
                <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Unknown command:&quot;</span><span class="p">,</span> <span class="n">command</span><span class="o">.</span><span class="n">to_string</span><span class="p">())</span></div>
</div>



<span class="c1">##############################</span>
<span class="c1"># MAIN</span>
<div class="viewcode-block" id="main">
<a class="viewcode-back" href="../../reference.html#MeasurementSystem.measurement_server.main">[docs]</a>
<span class="k">def</span> <span class="nf">main</span><span class="p">():</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Main loop of the measurement system.</span>

<span class="sd">    The main loop receives commands from the server and executes them. The loop</span>
<span class="sd">    is executed until the program is interrupted by a keyboard interrupt (Ctrl+C).</span>

<span class="sd">    The main loop consists of two parts: the receive loop and the overall loop.</span>

<span class="sd">    The receive loop receives commands from the server and executes them. The</span>
<span class="sd">    receive loop is executed until an error occurs or the program is interrupted</span>
<span class="sd">    by a keyboard interrupt.</span>

<span class="sd">    The overall loop is executed until the program is interrupted by a keyboard</span>
<span class="sd">    interrupt. The overall loop timer is set to 0.5 seconds.</span>

<span class="sd">    If an error occurs, the program will print the error message and the</span>
<span class="sd">    traceback, and then exit with an error code.</span>

<span class="sd">    If the program is interrupted by a keyboard interrupt, the program will print</span>
<span class="sd">    a message and exit with an error code.</span>

<span class="sd">    :return: None</span>
<span class="sd">    :rtype: None</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="c1"># Get server address from arguments, otherwise use default</span>
    <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">sys</span><span class="o">.</span><span class="n">argv</span><span class="p">)</span> <span class="o">==</span> <span class="mi">2</span><span class="p">:</span>
        <span class="n">address_str</span> <span class="o">=</span> <span class="n">sys</span><span class="o">.</span><span class="n">argv</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span>

        <span class="k">try</span><span class="p">:</span>
            <span class="n">ip_address</span><span class="p">,</span> <span class="n">port_str</span> <span class="o">=</span> <span class="n">address_str</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s2">&quot;:&quot;</span><span class="p">)</span>
            <span class="n">port</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">port_str</span><span class="p">)</span>  <span class="c1"># Convert port to an integer</span>
        <span class="k">except</span> <span class="ne">ValueError</span><span class="p">:</span>
            <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Invalid format. Expected format is IP_ADDRESS:PORT&quot;</span><span class="p">)</span>
            <span class="n">sys</span><span class="o">.</span><span class="n">exit</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span>

        <span class="n">server_address</span> <span class="o">=</span> <span class="p">(</span><span class="n">ip_address</span><span class="p">,</span> <span class="n">port</span><span class="p">)</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">server_address</span> <span class="o">=</span> <span class="n">default_server_address</span>

    <span class="c1"># Only one instance of the measurement system is allowed</span>
    <span class="k">if</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">exists</span><span class="p">(</span><span class="n">LOCKFILE</span><span class="p">):</span>
        <span class="nb">print</span><span class="p">(</span>
            <span class="s2">&quot;Another instance of the measurement system is already running.&quot;</span><span class="p">,</span>
            <span class="n">file</span><span class="o">=</span><span class="n">sys</span><span class="o">.</span><span class="n">stderr</span><span class="p">,</span>
        <span class="p">)</span>
        <span class="nb">print</span><span class="p">(</span>
            <span class="s2">&quot;The instance will be killed and lock released. Please try again.&quot;</span><span class="p">,</span>
            <span class="n">file</span><span class="o">=</span><span class="n">sys</span><span class="o">.</span><span class="n">stderr</span><span class="p">,</span>
        <span class="p">)</span>

        <span class="c1"># remove lockfile and kill itself</span>
        <span class="n">os</span><span class="o">.</span><span class="n">remove</span><span class="p">(</span><span class="n">LOCKFILE</span><span class="p">)</span>
        <span class="n">os</span><span class="o">.</span><span class="n">system</span><span class="p">(</span><span class="s2">&quot;pkill -f measurement_server.py&quot;</span><span class="p">)</span>
        <span class="n">sys</span><span class="o">.</span><span class="n">exit</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span>  <span class="c1"># never reached since pkill kills the process</span>

    <span class="c1"># Create lockfile</span>
    <span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="n">LOCKFILE</span><span class="p">,</span> <span class="s2">&quot;w&quot;</span><span class="p">)</span> <span class="k">as</span> <span class="n">f</span><span class="p">:</span>
        <span class="n">f</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="nb">str</span><span class="p">(</span><span class="n">datetime</span><span class="o">.</span><span class="n">now</span><span class="p">()))</span>
        <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Lockfile created:&quot;</span><span class="p">,</span> <span class="n">LOCKFILE</span><span class="p">)</span>

    <span class="c1"># Main loop</span>
    <span class="n">i_trials</span> <span class="o">=</span> <span class="mi">0</span>
    <span class="k">while</span> <span class="kc">True</span><span class="p">:</span>
        <span class="n">i_trials</span> <span class="o">+=</span> <span class="mi">1</span>
        <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Trial: &quot;</span><span class="p">,</span> <span class="n">i_trials</span><span class="p">)</span>

        <span class="k">try</span><span class="p">:</span>
            <span class="c1"># server_address = (&#39;192.168.1.31&#39;, 8008)</span>
            <span class="n">measurementSystem</span> <span class="o">=</span> <span class="kc">None</span>
            <span class="n">measurementSystem</span> <span class="o">=</span> <span class="n">MeasurementSystem</span><span class="p">(</span><span class="n">server_address</span><span class="p">)</span>
            <span class="n">measurementSystem</span><span class="o">.</span><span class="n">printConsole</span><span class="p">(</span><span class="s2">&quot;Measurement system connected!&quot;</span><span class="p">)</span>

            <span class="c1"># Receive loop</span>
            <span class="k">while</span> <span class="kc">True</span><span class="p">:</span>
                <span class="n">commands</span> <span class="o">=</span> <span class="n">measurementSystem</span><span class="o">.</span><span class="n">server_connection</span><span class="o">.</span><span class="n">receive</span><span class="p">()</span>  <span class="c1"># blocking</span>
                <span class="n">measurementSystem</span><span class="o">.</span><span class="n">process_commands</span><span class="p">(</span><span class="n">commands</span><span class="p">)</span>
                <span class="n">time</span><span class="o">.</span><span class="n">sleep</span><span class="p">(</span><span class="mf">0.5</span><span class="p">)</span>  <span class="c1"># Receive loop timer</span>

        <span class="k">except</span> <span class="ne">KeyboardInterrupt</span><span class="p">:</span>
            <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;</span><span class="se">\n</span><span class="s2">&gt;&gt; Exiting...&quot;</span><span class="p">)</span>
            <span class="k">break</span>

        <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
            <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;&gt;&gt;&gt; </span><span class="si">{</span><span class="nb">type</span><span class="p">(</span><span class="n">e</span><span class="p">)</span><span class="o">.</span><span class="vm">__name__</span><span class="si">}</span><span class="s2">:&quot;</span><span class="p">,</span> <span class="n">e</span><span class="p">)</span>
            <span class="n">traceback</span><span class="o">.</span><span class="n">print_exception</span><span class="p">(</span><span class="nb">type</span><span class="p">(</span><span class="n">e</span><span class="p">),</span> <span class="n">e</span><span class="p">,</span> <span class="n">e</span><span class="o">.</span><span class="n">__traceback__</span><span class="p">)</span>  <span class="c1"># for debugging purpose only</span>

        <span class="k">finally</span><span class="p">:</span>
            <span class="k">try</span><span class="p">:</span>
                <span class="k">if</span> <span class="n">measurementSystem</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
                    <span class="n">measurementSystem</span><span class="o">.</span><span class="n">close</span><span class="p">()</span>
                    <span class="n">measurementSystem</span> <span class="o">=</span> <span class="kc">None</span>
            <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
                <span class="k">raise</span> <span class="n">e</span>

        <span class="c1"># Overall loop timer</span>
        <span class="n">time</span><span class="o">.</span><span class="n">sleep</span><span class="p">(</span><span class="mf">0.5</span><span class="p">)</span>
        <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;</span><span class="se">\n</span><span class="s2">----------------------------------------</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">)</span>

    <span class="c1"># remove lockfile</span>
    <span class="k">if</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">exists</span><span class="p">(</span><span class="n">LOCKFILE</span><span class="p">):</span>
        <span class="n">os</span><span class="o">.</span><span class="n">remove</span><span class="p">(</span><span class="n">LOCKFILE</span><span class="p">)</span>
        <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Lockfile removed.&quot;</span><span class="p">)</span>

    <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Application closed.&quot;</span><span class="p">)</span>
    <span class="n">sys</span><span class="o">.</span><span class="n">exit</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span></div>



<span class="k">if</span> <span class="vm">__name__</span> <span class="o">==</span> <span class="s2">&quot;__main__&quot;</span><span class="p">:</span>
    <span class="n">main</span><span class="p">()</span>
</pre></div>

           </div>
          </div>
          <footer>

  <hr/>

  <div role="contentinfo">
    <p>&#169; Copyright 2024, Alfred Paar.</p>
  </div>

  Built with <a href="https://www.sphinx-doc.org/">Sphinx</a> using a
    <a href="https://github.com/readthedocs/sphinx_rtd_theme">theme</a>
    provided by <a href="https://readthedocs.org">Read the Docs</a>.


</footer>
        </div>
      </div>
    </section>
  </div>
  <script>
      jQuery(function () {
          SphinxRtdTheme.Navigation.enable(true);
      });
  </script>

</body>
</html>
